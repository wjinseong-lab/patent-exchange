<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horizon ‚Äî Patent Intelligence & Trading Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
<style>
:root{--bg-primary:#0a0e17;--bg-secondary:#111827;--bg-card:#1a1f2e;--bg-card-hover:#222938;--bg-surface:#151a28;--border:#1e293b;--border-light:#2d3748;--text-primary:#e2e8f0;--text-secondary:#94a3b8;--text-muted:#64748b;--accent:#3b82f6;--accent-light:#60a5fa;--accent-glow:rgba(59,130,246,.25);--emerald:#10b981;--emerald-d:#059669;--amber:#f59e0b;--amber-d:#d97706;--cyan:#06b6d4;--red:#ef4444;--purple:#8b5cf6;--sep-bg:rgba(245,158,11,.1);--sep-color:#fbbf24;--sep-border:rgba(245,158,11,.3);--green-up:#22c55e;--red-down:#ef4444;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;}
.container{max-width:1400px;margin:0 auto;padding:0 20px;}

/* ===== LOGIN SCREEN ===== */
.login-screen{position:fixed;inset:0;z-index:200;background:var(--bg-primary);display:flex;align-items:center;justify-content:center;overflow:hidden;}
.login-bg{position:absolute;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(59,130,246,.12) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(139,92,246,.08) 0%,transparent 50%),radial-gradient(ellipse at 50% 50%,rgba(6,182,212,.05) 0%,transparent 60%);}
.login-particles{position:absolute;inset:0;overflow:hidden;}
.login-particle{position:absolute;width:2px;height:2px;background:var(--accent);border-radius:50%;opacity:.3;animation:float-particle linear infinite;}
@keyframes float-particle{0%{transform:translateY(100vh) translateX(0);opacity:0;}10%{opacity:.4;}90%{opacity:.4;}100%{transform:translateY(-10vh) translateX(40px);opacity:0;}}
.login-card{position:relative;width:420px;max-width:90vw;background:rgba(26,31,46,.85);backdrop-filter:blur(24px);border:1px solid var(--border-light);border-radius:24px;padding:48px 40px;box-shadow:0 32px 64px rgba(0,0,0,.4),0 0 0 1px rgba(255,255,255,.03);z-index:1;}
.login-logo{text-align:center;margin-bottom:32px;}
.login-logo .logo-mark{width:64px;height:64px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:16px;display:inline-flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;color:#fff;letter-spacing:-1px;margin-bottom:16px;box-shadow:0 8px 32px var(--accent-glow);}
.login-logo h1{font-size:28px;font-weight:800;letter-spacing:-0.5px;background:linear-gradient(135deg,#fff,#94a3b8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.login-logo p{font-size:13px;color:var(--text-muted);margin-top:6px;}
.login-form{margin-bottom:20px;}
.login-field{margin-bottom:16px;}
.login-field label{display:block;font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;}
.login-field input{width:100%;padding:12px 16px;background:var(--bg-primary);border:1px solid var(--border-light);border-radius:12px;color:var(--text-primary);font-size:14px;outline:none;transition:all .2s;}
.login-field input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);}
.login-field input::placeholder{color:var(--text-muted);}
.login-role-select{margin-bottom:20px;}
.login-role-select label{display:block;font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px;}
.login-roles{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
.login-role-opt{padding:10px 6px;background:var(--bg-primary);border:1.5px solid var(--border-light);border-radius:10px;cursor:pointer;text-align:center;transition:all .2s;font-size:10px;font-weight:600;color:var(--text-muted);}
.login-role-opt:hover{border-color:var(--accent);color:var(--text-secondary);}
.login-role-opt.active{border-color:var(--accent);background:rgba(59,130,246,.1);color:var(--accent-light);}
.login-role-opt .role-emoji{font-size:18px;display:block;margin-bottom:3px;}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),#2563eb);border:none;border-radius:12px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:0 4px 16px var(--accent-glow);}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px var(--accent-glow);}
.login-divider{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--text-muted);font-size:11px;}
.login-divider::before,.login-divider::after{content:'';flex:1;height:1px;background:var(--border-light);}
.login-guest{width:100%;padding:12px;background:transparent;border:1px solid var(--border-light);border-radius:12px;color:var(--text-secondary);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
.login-guest:hover{background:var(--bg-card);border-color:var(--text-muted);}
.login-demo{margin-top:16px;text-align:center;font-size:10px;color:var(--text-muted);line-height:1.6;}
.login-demo code{background:var(--bg-primary);padding:1px 5px;border-radius:4px;font-family:'SF Mono','Fira Code',monospace;font-size:9px;color:var(--text-secondary);}

/* ===== HEADER ===== */
header{background:rgba(17,24,39,.8);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:40;}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 0;gap:10px;}
.logo-area{display:flex;align-items:center;gap:10px;}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:16px;letter-spacing:-1px;box-shadow:0 4px 12px var(--accent-glow);}
.logo-text h1{font-size:18px;font-weight:800;letter-spacing:-.3px;color:#fff;}.logo-text p{font-size:10px;color:var(--text-muted);}
.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.user-badge{display:flex;align-items:center;gap:8px;background:var(--bg-card);border:1px solid var(--border-light);border-radius:12px;padding:6px 12px;}
.user-badge .user-avatar{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--purple));display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff;font-weight:700;}
.user-badge .user-info{font-size:11px;line-height:1.3;}
.user-badge .user-name{font-weight:700;color:var(--text-primary);}
.user-badge .user-role{color:var(--accent-light);font-size:10px;}
.logout-btn{padding:6px 12px;font-size:10px;font-weight:600;border-radius:8px;border:1px solid var(--border-light);background:transparent;color:var(--text-muted);cursor:pointer;transition:all .2s;}
.logout-btn:hover{border-color:var(--red);color:var(--red);background:rgba(239,68,68,.1);}
.lang-selector{display:flex;gap:2px;align-items:center;border:1px solid var(--border);border-radius:10px;padding:2px;background:var(--bg-card);}
.lang-btn{width:30px;height:22px;border:1.5px solid transparent;border-radius:6px;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:all .15s;background:none;padding:0;}
.lang-btn:hover{background:var(--bg-surface);border-color:var(--border-light);}
.lang-btn.active{border-color:var(--accent);background:rgba(59,130,246,.1);box-shadow:0 1px 4px var(--accent-glow);}

/* ===== NAV ===== */
nav{background:var(--bg-secondary);border-bottom:1px solid var(--border);}
.nav-inner{display:flex;gap:2px;padding:4px 0;overflow-x:auto;}
.tab-btn{display:flex;align-items:center;gap:5px;padding:8px 14px;font-size:11px;font-weight:600;border-radius:8px;border:none;cursor:pointer;background:transparent;color:var(--text-muted);transition:all .2s;white-space:nowrap;}
.tab-btn:hover{background:var(--bg-card);color:var(--text-secondary);}
.tab-btn.active{background:var(--accent);color:#fff;box-shadow:0 4px 12px var(--accent-glow);}
.tab-btn svg{width:14px;height:14px;}

/* ===== MAIN ===== */
main{padding:20px 0;}
.tab-content{display:none;}.tab-content.active{display:block;}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px;}
.stat-card{padding:18px;border-radius:16px;border:1px solid var(--border);background:var(--bg-card);position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;inset:0;opacity:.08;border-radius:16px;}
.stat-card.sc-blue::before{background:linear-gradient(135deg,var(--accent),var(--cyan));}
.stat-card.sc-green::before{background:linear-gradient(135deg,var(--emerald),var(--cyan));}
.stat-card.sc-amber::before{background:linear-gradient(135deg,var(--amber),#f97316);}
.stat-card.sc-purple::before{background:linear-gradient(135deg,var(--purple),var(--accent));}
.stat-card.sc-cyan::before{background:linear-gradient(135deg,var(--cyan),var(--emerald));}
.stat-card .label{font-size:11px;color:var(--text-muted);margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;}
.stat-card .label .emoji{font-size:18px;}
.stat-card .val{font-size:24px;font-weight:800;color:var(--text-primary);}
.stat-card .val .unit{font-size:12px;font-weight:400;color:var(--text-muted);margin-left:3px;}
.stat-card .kr-sub{font-size:9px;color:var(--text-muted);margin-top:3px;}

.card{background:var(--bg-card);border-radius:16px;padding:20px;border:1px solid var(--border);margin-bottom:16px;transition:border-color .2s;}
.card:hover{border-color:var(--border-light);}
.card h3{font-size:15px;font-weight:700;margin-bottom:14px;color:var(--text-primary);}
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
.chart-container{position:relative;height:280px;}

table{width:100%;border-collapse:collapse;font-size:12px;}
th{text-align:left;padding:10px;font-weight:600;color:var(--text-muted);border-bottom:1px solid var(--border);font-size:10px;text-transform:uppercase;letter-spacing:.5px;}
td{padding:9px 10px;border-bottom:1px solid var(--border);color:var(--text-secondary);}
tr:hover td{background:var(--bg-surface);}
.mono{font-family:'SF Mono','Fira Code',monospace;font-size:10px;color:var(--text-muted);}
.badge{display:inline-block;padding:2px 8px;border-radius:50px;font-size:10px;font-weight:600;}
.badge-green{background:rgba(16,185,129,.15);color:var(--emerald);}.badge-blue{background:rgba(59,130,246,.15);color:var(--accent-light);}
.badge-amber{background:rgba(245,158,11,.15);color:var(--amber);}.badge-purple{background:rgba(139,92,246,.15);color:var(--purple);}
.badge-gray{background:rgba(100,116,139,.15);color:var(--text-muted);}.badge-red{background:rgba(239,68,68,.15);color:var(--red);}
.badge-sep{background:linear-gradient(135deg,rgba(251,191,36,.2),rgba(245,158,11,.15));color:var(--sep-color);font-weight:700;letter-spacing:.5px;padding:2px 8px;border-radius:50px;font-size:9px;text-transform:uppercase;border:1px solid var(--sep-border);}
.badge-sep::before{content:'‚òÖ ';font-size:8px;}
.sep-indicator{display:inline-flex;align-items:center;gap:4px;background:var(--sep-bg);border:1px solid var(--sep-border);border-radius:8px;padding:3px 8px;font-size:9px;font-weight:700;color:var(--sep-color);}

.filter-bar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
.filter-bar input,.filter-bar select{padding:8px 14px;border-radius:10px;border:1px solid var(--border);font-size:12px;outline:none;transition:all .2s;background:var(--bg-surface);color:var(--text-primary);}
.filter-bar input:focus,.filter-bar select:focus{box-shadow:0 0 0 3px var(--accent-glow);border-color:var(--accent);}
.filter-bar input{flex:1;min-width:180px;}
.filter-bar select{color:var(--text-secondary);}
.filter-bar select option{background:var(--bg-card);color:var(--text-primary);}
.patent-item{background:var(--bg-card);border-radius:14px;padding:16px;border:1px solid var(--border);margin-bottom:10px;transition:all .2s;}
.patent-item:hover{border-color:var(--border-light);box-shadow:0 4px 20px rgba(0,0,0,.2);}
.patent-item.is-sep{border-left:3px solid var(--sep-color);}
.patent-header{display:flex;justify-content:space-between;align-items:flex-start;gap:14px;flex-wrap:wrap;}
.patent-info{flex:1;min-width:220px;}
.patent-meta{display:flex;gap:5px;align-items:center;margin-bottom:4px;flex-wrap:wrap;}
.patent-title{font-size:14px;font-weight:700;cursor:pointer;transition:color .2s;color:var(--text-primary);}
.patent-title:hover{color:var(--accent-light);}
.patent-title-kr{font-size:11px;color:var(--text-muted);margin-bottom:4px;}
.patent-sub{font-size:11px;color:var(--text-muted);margin-bottom:4px;}
.patent-sub strong{color:var(--text-secondary);}
.patent-desc{font-size:11px;color:var(--text-muted);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.patent-actions{text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:8px;}
.patent-value{font-size:20px;font-weight:800;color:var(--accent-light);}
.btn-group{display:flex;gap:5px;flex-wrap:wrap;}
.btn{padding:6px 12px;font-size:10px;font-weight:600;border-radius:8px;border:none;cursor:pointer;transition:all .2s;}
.btn-outline{border:1px solid var(--border-light);color:var(--text-secondary);background:transparent;}.btn-outline:hover{background:var(--bg-surface);border-color:var(--text-muted);}
.btn-primary{background:var(--accent);color:#fff;box-shadow:0 2px 8px var(--accent-glow);}.btn-primary:hover{background:#2563eb;}
.btn-emerald{background:var(--emerald-d);color:#fff;}.btn-emerald:hover{background:#047857;}
.btn-orange{background:#f97316;color:#fff;}.btn-orange:hover{background:#ea580c;}
.btn-gray{background:var(--bg-surface);color:var(--text-secondary);border:1px solid var(--border);}.btn-gray:hover{background:var(--bg-card-hover);}
.btn-purple{background:var(--purple);color:#fff;}.btn-purple:hover{background:#7c3aed;}
.btn-lg{padding:12px 20px;font-size:13px;border-radius:12px;flex:1;}
.btn-link{background:none;border:none;color:var(--accent-light);cursor:pointer;font-size:10px;font-weight:600;}.btn-link:hover{text-decoration:underline;}

/* ===== MODALS ===== */
.modal-overlay{display:none;position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);align-items:center;justify-content:center;padding:16px;}
.modal-overlay.show{display:flex;}
.modal{background:var(--bg-card);border:1px solid var(--border-light);border-radius:20px;box-shadow:0 24px 64px rgba(0,0,0,.4);width:100%;max-height:90vh;overflow-y:auto;}
.modal-sm{max-width:540px;}.modal-md{max-width:620px;}.modal-lg{max-width:760px;}.modal-xl{max-width:960px;}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 20px 0;}
.modal-header h2{font-size:16px;font-weight:700;color:var(--text-primary);}
.modal-close{width:32px;height:32px;border-radius:50%;border:none;cursor:pointer;background:var(--bg-surface);color:var(--text-muted);font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.modal-close:hover{background:var(--border-light);color:var(--text-primary);}
.modal-body{padding:20px;}
.form-group{margin-bottom:12px;}
.form-label{display:block;font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:5px;}
.form-input,.form-select,.form-textarea{width:100%;padding:9px 14px;border-radius:10px;border:1px solid var(--border);font-size:12px;outline:none;transition:all .2s;font-family:inherit;background:var(--bg-surface);color:var(--text-primary);}
.form-input:focus,.form-select:focus,.form-textarea:focus{box-shadow:0 0 0 3px var(--accent-glow);border-color:var(--accent);}
.form-input::placeholder,.form-textarea::placeholder{color:var(--text-muted);}
.form-select option{background:var(--bg-card);color:var(--text-primary);}
.form-hint{font-size:10px;color:var(--text-muted);margin-top:3px;}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
.info-box{border-radius:12px;padding:14px;margin-bottom:16px;}
.info-box-blue{background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.15);}
.info-box-emerald{background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.15);}
.info-box .info-label{font-size:10px;margin-bottom:3px;color:var(--text-muted);}
.info-box .info-title{font-size:14px;font-weight:700;color:var(--text-primary);}
.info-box .info-sub{font-size:11px;color:var(--text-secondary);margin-top:3px;}
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.type-card{padding:14px;border-radius:12px;border:1.5px solid var(--border);cursor:pointer;text-align:left;background:var(--bg-surface);transition:all .2s;}
.type-card:hover{border-color:var(--border-light);}.type-card.selected{border-color:var(--emerald);background:rgba(16,185,129,.08);}
.type-card h4{font-size:13px;font-weight:700;color:var(--text-primary);margin-bottom:3px;}.type-card p{font-size:10px;color:var(--text-muted);}
.condition-box{background:var(--bg-surface);border-radius:12px;padding:14px;margin-bottom:14px;border:1px solid var(--border);}
.condition-box h4{font-size:12px;font-weight:700;margin-bottom:10px;color:var(--text-secondary);}
.sim-box{background:var(--bg-card);border-radius:10px;padding:10px 14px;border:1px solid var(--border);margin-top:10px;}
.sim-label{font-size:10px;font-weight:600;color:var(--text-muted);margin-bottom:3px;}
.sim-value{font-size:18px;font-weight:800;color:var(--emerald);}
.sim-sub{font-size:10px;color:var(--text-muted);margin-top:2px;}
.score-bar-bg{width:50px;height:7px;background:var(--bg-surface);border-radius:50px;display:inline-block;vertical-align:middle;margin-right:4px;}
.score-bar{height:7px;border-radius:50px;}
.detail-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:16px;}
.detail-item{background:var(--bg-surface);border-radius:10px;padding:10px;border:1px solid var(--border);}
.detail-item .d-label{font-size:9px;color:var(--text-muted);margin-bottom:3px;text-transform:uppercase;letter-spacing:.3px;}
.detail-item .d-value{font-size:13px;font-weight:700;color:var(--text-primary);}
.notification{position:fixed;top:14px;right:14px;z-index:100;padding:12px 20px;border-radius:12px;color:#fff;font-size:12px;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,.3);transform:translateY(-20px);opacity:0;transition:all .3s;max-width:400px;border:1px solid rgba(255,255,255,.1);}
.notification.show{transform:translateY(0);opacity:1;}
.notification.success{background:var(--emerald);}.notification.error{background:var(--red);}.notification.info{background:var(--accent);}
footer{border-top:1px solid var(--border);background:var(--bg-secondary);margin-top:30px;padding:14px 0;text-align:center;font-size:10px;color:var(--text-muted);}

/* ===== AI AGENT STYLES ===== */
.agent-card{background:var(--bg-card);border-radius:14px;padding:16px;border:1px solid var(--border);margin-bottom:10px;transition:all .2s;position:relative;}
.agent-card:hover{border-color:var(--border-light);}
.agent-card.agent-active{border-left:3px solid var(--emerald);}
.agent-card.agent-paused{border-left:3px solid var(--text-muted);opacity:.6;}
.agent-avatar{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
.agent-header{display:flex;gap:12px;align-items:flex-start;}
.agent-info{flex:1;}.agent-name{font-size:14px;font-weight:700;color:var(--text-primary);}
.agent-type{font-size:10px;color:var(--text-muted);margin-top:2px;}
.agent-stats{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;}
.agent-stat{background:var(--bg-surface);border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-size:10px;text-align:center;min-width:80px;}
.agent-stat .as-val{font-size:16px;font-weight:800;color:var(--accent-light);}
.agent-stat .as-label{color:var(--text-muted);margin-top:2px;}
.agent-actions-bar{display:flex;gap:6px;margin-top:10px;}
.feed-item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);font-size:12px;align-items:flex-start;}
.feed-icon{width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.feed-content{flex:1;}.feed-title{font-weight:600;margin-bottom:2px;color:var(--text-primary);}.feed-desc{color:var(--text-muted);font-size:11px;}
.feed-time{font-size:10px;color:var(--text-muted);white-space:nowrap;}
.rec-card{background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.15);border-radius:14px;padding:16px;margin-bottom:10px;}
.rec-card h4{font-size:13px;font-weight:700;color:var(--text-primary);margin-bottom:6px;display:flex;align-items:center;gap:6px;}
.rec-card p{font-size:11px;color:var(--text-secondary);line-height:1.5;}
.rec-card .rec-action{display:flex;gap:6px;margin-top:10px;}
.rec-score{display:inline-flex;align-items:center;gap:3px;background:var(--accent);color:#fff;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;}
.nego-timeline{position:relative;padding-left:24px;}
.nego-timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--border);}
.nego-step{position:relative;padding:8px 0 16px;font-size:12px;}
.nego-step::before{content:'';position:absolute;left:-20px;top:12px;width:12px;height:12px;border-radius:50%;border:2px solid var(--border-light);background:var(--bg-card);z-index:1;}
.nego-step.done::before{background:var(--emerald);border-color:var(--emerald);}
.nego-step.active::before{background:var(--accent);border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
.nego-step .ns-title{font-weight:600;color:var(--text-primary);}.nego-step .ns-desc{color:var(--text-muted);font-size:11px;margin-top:2px;}

/* ===== CANDLE ===== */
.candle-wrap{background:var(--bg-secondary);border:1px solid var(--border);border-radius:14px;overflow:hidden;}
.candle-toolbar{display:flex;gap:4px;padding:10px 14px;background:var(--bg-secondary);align-items:center;flex-wrap:wrap;}
.candle-toolbar .tb-label{font-size:10px;color:var(--text-muted);margin-right:6px;}
.candle-toolbar .tb-btn{padding:4px 10px;font-size:10px;font-weight:600;border:1px solid var(--border);border-radius:6px;background:transparent;color:var(--text-muted);cursor:pointer;transition:all .15s;}
.candle-toolbar .tb-btn:hover{background:var(--bg-card);color:var(--text-secondary);}.candle-toolbar .tb-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.candle-toolbar .tb-sep{width:1px;height:18px;background:var(--border);margin:0 6px;}
.candle-info{display:flex;gap:14px;padding:0 14px 6px;font-size:10px;}
.candle-info span{color:var(--text-muted);}.candle-info .up{color:var(--green-up);}.candle-info .down{color:var(--red-down);}
.candle-canvas-wrap canvas{display:block;width:100%;cursor:crosshair;}
.candle-legend{display:flex;gap:14px;padding:6px 14px 10px;font-size:9px;color:var(--text-muted);}
.candle-legend .leg-dot{display:inline-block;width:8px;height:3px;border-radius:2px;margin-right:3px;vertical-align:middle;}
.chart-patent-select{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.chart-patent-chip{padding:5px 12px;font-size:10px;font-weight:600;border-radius:8px;border:1px solid var(--border);background:var(--bg-surface);color:var(--text-muted);cursor:pointer;transition:all .15s;white-space:nowrap;}
.chart-patent-chip:hover{border-color:var(--accent);color:var(--accent-light);}
.chart-patent-chip.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.sep-filter{padding:5px 12px;font-size:10px;font-weight:700;border-radius:8px;border:1px solid var(--sep-border);background:var(--sep-bg);color:var(--sep-color);cursor:pointer;transition:all .2s;}.sep-filter.active{background:rgba(251,191,36,.3);}
.upload-zone{border:2px dashed var(--border-light);border-radius:14px;padding:28px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:14px;background:var(--bg-surface);color:var(--text-muted);}
.upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:rgba(59,130,246,.05);}
.pulse{animation:pulse 2s infinite;}@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.5;}}

/* ===== VALUATION TOOL ===== */
.vtool-tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:14px;}
.vtool-tab{padding:10px 16px;font-size:11px;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;color:var(--text-muted);transition:all .2s;background:none;border-top:none;border-left:none;border-right:none;}
.vtool-tab:hover{color:var(--text-secondary);}
.vtool-tab.active{color:var(--accent-light);border-bottom-color:var(--accent);}
.vtool-panel{display:none;}.vtool-panel.active{display:block;}
.infr-card{border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;display:flex;gap:12px;align-items:flex-start;background:var(--bg-surface);}
.infr-card.infr-high{border-left:4px solid var(--red);background:rgba(239,68,68,.05);}
.infr-card.infr-med{border-left:4px solid var(--amber);background:rgba(245,158,11,.05);}
.infr-card.infr-low{border-left:4px solid var(--emerald);background:rgba(16,185,129,.05);}
.infr-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.infr-info{flex:1;}.infr-name{font-size:13px;font-weight:700;color:var(--text-primary);margin-bottom:2px;}.infr-company{font-size:10px;color:var(--text-muted);}
.infr-detail{font-size:11px;color:var(--text-secondary);margin-top:4px;line-height:1.5;}
.claim-card{background:var(--bg-surface);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:8px;border-left:3px solid var(--accent);}
.claim-num{font-size:10px;font-weight:800;color:var(--accent-light);margin-bottom:4px;text-transform:uppercase;}
.claim-type{display:inline-block;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;}
.claim-ind{background:rgba(59,130,246,.15);color:var(--accent-light);}.claim-dep{background:rgba(139,92,246,.15);color:var(--purple);}
.claim-text{font-size:12px;color:var(--text-secondary);line-height:1.6;}
.claim-keywords{display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;}
.claim-kw{padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600;background:var(--bg-card);color:var(--text-muted);border:1px solid var(--border);}
.lic-ref-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);font-size:12px;color:var(--text-secondary);}
.lic-ref-row:last-child{border:none;}
.val-meter{height:10px;border-radius:5px;background:var(--bg-surface);overflow:hidden;margin-top:4px;}
.val-meter-fill{height:100%;border-radius:5px;transition:width .5s;}
.guest-notice{background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.2);border-radius:12px;padding:14px;margin-bottom:16px;font-size:12px;color:var(--amber);display:flex;align-items:center;gap:10px;}
@media(max-width:768px){.chart-row{grid-template-columns:1fr;}.form-row,.form-row-3,.type-grid{grid-template-columns:1fr;}.patent-header{flex-direction:column;}.login-roles{grid-template-columns:repeat(2,1fr);}.login-card{padding:32px 24px;}}
</style>
</head>
<body>
<div id="notification" class="notification"></div>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <div class="login-bg"></div>
  <div class="login-particles" id="loginParticles"></div>
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-mark">H</div>
      <h1>Horizon</h1>
      <p>Patent Intelligence & Trading Platform</p>
    </div>
    <div class="login-form">
      <div class="login-field">
        <label>Email</label>
        <input type="email" id="loginEmail" placeholder="Enter your email" value="buyer@horizon.io">
      </div>
      <div class="login-field">
        <label>Password</label>
        <input type="password" id="loginPass" placeholder="Enter password" value="password">
      </div>
    </div>
    <div class="login-role-select">
      <label>Login as</label>
      <div class="login-roles" id="loginRoles">
        <div class="login-role-opt active" onclick="selectLoginRole('buyer')"><span class="role-emoji">üõí</span>Buyer</div>
        <div class="login-role-opt" onclick="selectLoginRole('seller')"><span class="role-emoji">üè∑Ô∏è</span>Seller</div>
        <div class="login-role-opt" onclick="selectLoginRole('licensor')"><span class="role-emoji">üìú</span>Licensor</div>
        <div class="login-role-opt" onclick="selectLoginRole('licensee')"><span class="role-emoji">üîë</span>Licensee</div>
        <div class="login-role-opt" onclick="selectLoginRole('monitor')"><span class="role-emoji">üëÅÔ∏è</span>Monitor</div>
        <div class="login-role-opt" onclick="selectLoginRole('guest')"><span class="role-emoji">üåê</span>Guest</div>
      </div>
    </div>
    <button class="login-btn" onclick="doLogin()">Sign In</button>
    <div class="login-divider">or</div>
    <button class="login-guest" onclick="guestLogin()">Continue as Guest</button>
    <div class="login-demo">
      Demo accounts: <code>buyer@horizon.io</code> <code>seller@horizon.io</code> <code>licensee@horizon.io</code><br>
      <code>licensor@horizon.io</code> <code>monitor@horizon.io</code> &middot; Password: <code>password</code>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="appContainer" style="display:none">
<header>
<div class="container">
<div class="header-inner">
  <div class="logo-area">
    <div class="logo-icon">H</div>
    <div class="logo-text"><h1>Horizon</h1><p id="headerSubtext">Patent Intelligence & Trading</p></div>
  </div>
  <div class="header-right">
    <div class="lang-selector" id="langSelector">
      <button class="lang-btn active" onclick="setLang('en')" title="English">üá∫üá∏</button>
      <button class="lang-btn" onclick="setLang('ko')" title="ÌïúÍµ≠Ïñ¥">üá∞üá∑</button>
      <button class="lang-btn" onclick="setLang('zh')" title="‰∏≠Êñá">üá®üá≥</button>
      <button class="lang-btn" onclick="setLang('ja')" title="Êó•Êú¨Ë™û">üáØüáµ</button>
    </div>
    <div style="font-size:11px;color:var(--text-muted)" id="portfolioLabel">Portfolio: <strong id="totalValue" style="color:var(--accent-light);font-size:13px"></strong></div>
    <button class="btn btn-orange" onclick="openUploadModal()" style="font-size:11px;padding:7px 14px;border-radius:10px" id="registerBtn">+ Register Patent</button>
    <div class="user-badge" id="userBadge">
      <div class="user-avatar" id="userAvatar">B</div>
      <div class="user-info"><div class="user-name" id="userName">User</div><div class="user-role" id="userRoleLabel">Buyer</div></div>
    </div>
    <button class="logout-btn" onclick="doLogout()">Logout</button>
  </div>
</div>
</div>
</header>

<nav>
<div class="container"><div class="nav-inner" id="navTabs"></div></div>
</nav>

<main class="container">
<div id="tab-dashboard" class="tab-content active"></div>
<div id="tab-patents" class="tab-content"></div>
<div id="tab-agents" class="tab-content"></div>
<div id="tab-chart" class="tab-content"></div>
<div id="tab-value" class="tab-content"></div>
<div id="tab-transactions" class="tab-content"></div>
</main>

<footer><div class="container" id="footerText">Horizon &copy; 2026 &middot; Patent Intelligence & Trading Platform</div></footer>
</div>

<!-- Modals -->
<div id="detailModal" class="modal-overlay" onclick="if(event.target===this)closeModal('detailModal')"><div class="modal modal-lg"><div class="modal-header"><h2 id="detailModalTitle">Patent Details</h2><button class="modal-close" onclick="closeModal('detailModal')">&times;</button></div><div class="modal-body" id="detailBody"></div></div></div>
<div id="tradeModal" class="modal-overlay" onclick="if(event.target===this)closeModal('tradeModal')"><div class="modal modal-md"><div class="modal-header"><h2>Trade Request</h2><button class="modal-close" onclick="closeModal('tradeModal')">&times;</button></div><div class="modal-body" id="tradeBody"></div></div></div>
<div id="licenseModal" class="modal-overlay" onclick="if(event.target===this)closeModal('licenseModal')"><div class="modal modal-lg"><div class="modal-header"><h2>License Request</h2><button class="modal-close" onclick="closeModal('licenseModal')">&times;</button></div><div class="modal-body" id="licenseBody"></div></div></div>
<div id="uploadModal" class="modal-overlay" onclick="if(event.target===this)closeModal('uploadModal')"><div class="modal modal-lg"><div class="modal-header"><h2>Register Patent</h2><button class="modal-close" onclick="closeModal('uploadModal')">&times;</button></div><div class="modal-body" id="uploadBody"></div></div></div>
<div id="candleModal" class="modal-overlay" onclick="if(event.target===this)closeModal('candleModal')"><div class="modal modal-xl"><div class="modal-header"><h2 id="candleModalTitle">Value Chart</h2><button class="modal-close" onclick="closeModal('candleModal')">&times;</button></div><div class="modal-body" id="candleModalBody" style="padding:0"></div></div></div>
<div id="agentModal" class="modal-overlay" onclick="if(event.target===this)closeModal('agentModal')"><div class="modal modal-lg"><div class="modal-header"><h2 id="agentModalTitle">AI Agent</h2><button class="modal-close" onclick="closeModal('agentModal')">&times;</button></div><div class="modal-body" id="agentModalBody"></div></div></div>
<div id="negoModal" class="modal-overlay" onclick="if(event.target===this)closeModal('negoModal')"><div class="modal modal-lg"><div class="modal-header"><h2>AI Negotiation</h2><button class="modal-close" onclick="closeModal('negoModal')">&times;</button></div><div class="modal-body" id="negoModalBody"></div></div></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGIN & AUTH SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let isLoggedIn=false;
let currentUser=null;
let selectedLoginRole='buyer';

const DEMO_ACCOUNTS={
  'buyer@horizon.io':{name:'Alex Chen',role:'buyer',avatar:'AC'},
  'seller@horizon.io':{name:'Sarah Kim',role:'seller',avatar:'SK'},
  'licensor@horizon.io':{name:'David Park',role:'licensor',avatar:'DP'},
  'licensee@horizon.io':{name:'Emily Wong',role:'licensee',avatar:'EW'},
  'monitor@horizon.io':{name:'James Lee',role:'monitor',avatar:'JL'}
};

function selectLoginRole(role){
  selectedLoginRole=role;
  document.querySelectorAll('.login-role-opt').forEach(el=>el.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

function doLogin(){
  const email=document.getElementById('loginEmail').value.trim();
  const pass=document.getElementById('loginPass').value;
  if(!email){notify('Please enter email.','error');return;}
  const demo=DEMO_ACCOUNTS[email.toLowerCase()];
  if(demo){
    currentUser={email,name:demo.name,role:demo.role,avatar:demo.avatar};
    currentRole=demo.role;
  }else{
    const nameFromEmail=email.split('@')[0].replace(/[._]/g,' ').replace(/\b\w/g,l=>l.toUpperCase());
    currentUser={email,name:nameFromEmail,role:selectedLoginRole,avatar:nameFromEmail.slice(0,2).toUpperCase()};
    currentRole=selectedLoginRole;
  }
  isLoggedIn=true;
  showApp();
}

function guestLogin(){
  currentUser={email:'guest',name:'Guest',role:'guest',avatar:'G'};
  currentRole='guest';
  isLoggedIn=true;
  showApp();
}

function doLogout(){
  isLoggedIn=false;currentUser=null;
  document.getElementById('appContainer').style.display='none';
  document.getElementById('loginScreen').style.display='flex';
}

function showApp(){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('appContainer').style.display='';
  document.getElementById('userName').textContent=currentUser.name;
  document.getElementById('userRoleLabel').textContent=T(currentRole);
  document.getElementById('userAvatar').textContent=currentUser.avatar;
  // Hide register button for guest/monitor
  const regBtn=document.getElementById('registerBtn');
  regBtn.style.display=(currentRole==='guest'||currentRole==='monitor')?'none':'';
  updateTV();renderNav();switchTab('dashboard');
  notify(`Welcome to Horizon, ${currentUser.name}!`,'info');
}

// Create login particles
function createParticles(){
  const c=document.getElementById('loginParticles');
  for(let i=0;i<30;i++){
    const p=document.createElement('div');p.className='login-particle';
    p.style.left=Math.random()*100+'%';
    p.style.animationDuration=(8+Math.random()*12)+'s';
    p.style.animationDelay=Math.random()*8+'s';
    p.style.width=p.style.height=(1+Math.random()*2)+'px';
    c.appendChild(p);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTERNATIONALIZATION (i18n)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentLang='en';
const LANGS={en:{flag:'üá∫üá∏',name:'English'},ko:{flag:'üá∞üá∑',name:'ÌïúÍµ≠Ïñ¥'},zh:{flag:'üá®üá≥',name:'‰∏≠Êñá'},ja:{flag:'üáØüáµ',name:'Êó•Êú¨Ë™û'}};
const i18n={
  headerSub:{en:'Patent Intelligence & Trading',ko:'ÌäπÌóà Ïù∏ÌÖîÎ¶¨Ï†ÑÏä§ & Ìä∏Î†àÏù¥Îî©',zh:'‰∏ìÂà©Êô∫ËÉΩ‰∏é‰∫§Êòì',ja:'ÁâπË®±„Ç§„É≥„ÉÜ„É™„Ç∏„Çß„É≥„ÇπÔºÜ„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞'},
  headerSubDesc:{en:'AI-Powered Patent Trading & Licensing',ko:'AI Í∏∞Î∞ò ÌäπÌóà Í±∞Îûò & ÎùºÏù¥ÏÑºÏã±',zh:'AIÈ©±Âä®ÁöÑ‰∏ìÂà©‰∫§Êòì‰∏éËÆ∏ÂèØ',ja:'AIÊê≠ËºâÁâπË®±ÂèñÂºï&„É©„Ç§„Çª„É≥„Ç∑„É≥„Ç∞'},
  portfolio:{en:'Portfolio',ko:'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§',zh:'ÊäïËµÑÁªÑÂêà',ja:'„Éù„Éº„Éà„Éï„Ç©„É™„Ç™'},
  registerPatent:{en:'+ Register Patent',ko:'+ ÌäπÌóà Îì±Î°ù',zh:'+ Ê≥®ÂÜå‰∏ìÂà©',ja:'+ ÁâπË®±ÁôªÈå≤'},
  footer:{en:'Horizon ¬© 2026 ¬∑ Patent Intelligence & Trading Platform',ko:'Horizon ¬© 2026 ¬∑ ÌäπÌóà Ïù∏ÌÖîÎ¶¨Ï†ÑÏä§ & Ìä∏Î†àÏù¥Îî© ÌîåÎû´Ìèº',zh:'Horizon ¬© 2026 ¬∑ ‰∏ìÂà©Êô∫ËÉΩ‰∏é‰∫§ÊòìÂπ≥Âè∞',ja:'Horizon ¬© 2026 ¬∑ ÁâπË®±„Ç§„É≥„ÉÜ„É™„Ç∏„Çß„É≥„ÇπÔºÜ„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞'},
  buyer:{en:'Buyer',ko:'Íµ¨Îß§Ïûê',zh:'‰π∞Êñπ',ja:'Ë≤∑„ÅÑÊâã'},
  seller:{en:'Seller',ko:'ÌåêÎß§Ïûê',zh:'ÂçñÊñπ',ja:'Â£≤„ÇäÊâã'},
  licensor:{en:'Licensor',ko:'ÎùºÏù¥ÏÑºÏÑú',zh:'ËÆ∏ÂèØÊñπ',ja:'„É©„Ç§„Çª„É≥„Çµ„Éº'},
  licensee:{en:'Licensee',ko:'ÎùºÏù¥ÏÑºÏãú',zh:'Ë¢´ËÆ∏ÂèØÊñπ',ja:'„É©„Ç§„Çª„É≥„Ç∑„Éº'},
  monitor:{en:'Monitor',ko:'Î™®ÎãàÌÑ∞',zh:'ÁõëÊéß',ja:'„É¢„Éã„Çø„Éº'},
  guest:{en:'Guest',ko:'Í≤åÏä§Ìä∏',zh:'ËÆøÂÆ¢',ja:'„Ç≤„Çπ„Éà'},
  dashboard:{en:'Dashboard',ko:'ÎåÄÏãúÎ≥¥Îìú',zh:'‰ª™Ë°®Êùø',ja:'„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ'},
  patents:{en:'Patents',ko:'ÌäπÌóà Î™©Î°ù',zh:'‰∏ìÂà©ÂàóË°®',ja:'ÁâπË®±‰∏ÄË¶ß'},
  aiAgents:{en:'AI Agents',ko:'AI ÏóêÏù¥Ï†ÑÌä∏',zh:'AI‰ª£ÁêÜ',ja:'AI„Ç®„Éº„Ç∏„Çß„É≥„Éà'},
  valueChart:{en:'Value Chart',ko:'Í∞ÄÏπò Ï∞®Ìä∏',zh:'‰ª∑ÂÄºÂõæË°®',ja:'‰æ°ÂÄ§„ÉÅ„É£„Éº„Éà'},
  analysis:{en:'Analysis',ko:'Í∞ÄÏπò Î∂ÑÏÑù',zh:'‰ª∑ÂÄºÂàÜÊûê',ja:'‰æ°ÂÄ§ÂàÜÊûê'},
  transactions:{en:'Transactions',ko:'Í±∞Îûò ÎÇ¥Ïó≠',zh:'‰∫§ÊòìËÆ∞ÂΩï',ja:'ÂèñÂºïÂ±•Ê≠¥'},
  totalPatents:{en:'Total Patents',ko:'Ï¥ù ÌäπÌóà Ïàò',zh:'‰∏ìÂà©ÊÄªÊï∞',ja:'ÁâπË®±Á∑èÊï∞'},
  portfolioValue:{en:'Portfolio Value',ko:'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í∞ÄÏπò',zh:'ÁªÑÂêà‰ª∑ÂÄº',ja:'„Éù„Éº„Éà„Éï„Ç©„É™„Ç™‰æ°ÂÄ§'},
  sepPatents:{en:'SEP Patents',ko:'ÌëúÏ§ÄÌïÑÏàòÌäπÌóà',zh:'Ê†áÂáÜÂøÖË¶Å‰∏ìÂà©',ja:'Ê®ôÊ∫ñÂøÖÈ†àÁâπË®±'},
  activeAgents:{en:'AI Agents',ko:'ÌôúÏÑ± ÏóêÏù¥Ï†ÑÌä∏',zh:'Ê¥ªË∑É‰ª£ÁêÜ',ja:'„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç®„Éº„Ç∏„Çß„É≥„Éà'},
  aiDeals:{en:'AI Deals',ko:'AI Í±∞Îûò',zh:'AI‰∫§Êòì',ja:'AIÂèñÂºï'},
  aiRecommendations:{en:'AI Recommendations',ko:'AI Ï∂îÏ≤ú',zh:'AIÊé®Ëçê',ja:'AI„É¨„Ç≥„É°„É≥„Éâ'},
  marketOverview:{en:'Market Overview',ko:'ÏãúÏû• Í∞úÏöî',zh:'Â∏ÇÂú∫Ê¶ÇÂÜµ',ja:'„Éû„Éº„Ç±„ÉÉ„ÉàÊ¶ÇË¶Å'},
  agentActivity:{en:'AI Agent Activity',ko:'ÏóêÏù¥Ï†ÑÌä∏ ÌôúÎèô',zh:'‰ª£ÁêÜÊ¥ªÂä®',ja:'„Ç®„Éº„Ç∏„Çß„É≥„ÉàÊ¥ªÂãï'},
  recentTransactions:{en:'Recent Transactions',ko:'ÏµúÍ∑º Í±∞Îûò',zh:'ÊúÄËøë‰∫§Êòì',ja:'ÊúÄËøë„ÅÆÂèñÂºï'},
  noActivity:{en:'No activity yet. Click "Run AI Cycle" in the Agents tab.',ko:'ÏïÑÏßÅ ÌôúÎèô ÏóÜÏùå. AI ÏóêÏù¥Ï†ÑÌä∏ ÌÉ≠ÏóêÏÑú ÏûêÎèô Îß§Ïπ≠ÏùÑ Ïã§ÌñâÌïòÏÑ∏Ïöî.',zh:'ÊöÇÊó†Ê¥ªÂä®„ÄÇËØ∑Âú®AI‰ª£ÁêÜÊ†áÁ≠æÈ°µ‰∏≠ËøêË°åAIÂë®Êúü„ÄÇ',ja:'„Åæ„Å†Ê¥ªÂãï„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇAI„Ç®„Éº„Ç∏„Çß„É≥„Éà„Çø„Éñ„ÅßÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'},
  noTransactions:{en:'No transactions yet.',ko:'ÏïÑÏßÅ Í±∞Îûò ÏóÜÏùå.',zh:'ÊöÇÊó†‰∫§Êòì„ÄÇ',ja:'„Åæ„Å†ÂèñÂºï„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ'},
  searchPatents:{en:'Search patents...',ko:'ÌäπÌóà Í≤ÄÏÉâ...',zh:'ÊêúÁ¥¢‰∏ìÂà©...',ja:'ÁâπË®±Ê§úÁ¥¢...'},
  details:{en:'Details',ko:'ÏÉÅÏÑ∏',zh:'ËØ¶ÊÉÖ',ja:'Ë©≥Á¥∞'},
  buy:{en:'Buy',ko:'Íµ¨Îß§',zh:'Ë¥≠‰π∞',ja:'Ë≥ºÂÖ•'},
  sell:{en:'Sell',ko:'ÌåêÎß§',zh:'Âá∫ÂîÆ',ja:'Â£≤Âç¥'},
  offerLicense:{en:'Offer License',ko:'ÎùºÏù¥ÏÑºÏä§ Ï†úÍ≥µ',zh:'Êèê‰æõËÆ∏ÂèØ',ja:'„É©„Ç§„Çª„É≥„ÇπÊèê‰æõ'},
  requestLicense:{en:'Request License',ko:'ÎùºÏù¥ÏÑºÏä§ ÏöîÏ≤≠',zh:'ËØ∑Ê±ÇËÆ∏ÂèØ',ja:'„É©„Ç§„Çª„É≥„ÇπË¶ÅÊ±Ç'},
  forSale:{en:'For Sale',ko:'Îß§ÎèÑÍ∞ÄÎä•',zh:'ÂèØÂîÆ',ja:'Â£≤Âç¥ÂèØ'},
  licensable:{en:'Licensable',ko:'ÎùºÏù¥ÏÑºÏä§Í∞ÄÎä•',zh:'ÂèØËÆ∏ÂèØ',ja:'„É©„Ç§„Çª„É≥„ÇπÂèØ'},
  overview:{en:'Overview',ko:'Í∞úÏöî',zh:'Ê¶ÇËø∞',ja:'Ê¶ÇË¶Å'},
  claims:{en:'Claims',ko:'Ï≤≠Íµ¨Ìï≠',zh:'ÊùÉÂà©Ë¶ÅÊ±Ç',ja:'Ë´ãÊ±ÇÈ†Ö'},
  infringement:{en:'Infringement',ko:'Ïπ®Ìï¥ Î∂ÑÏÑù',zh:'‰æµÊùÉÂàÜÊûê',ja:'‰æµÂÆ≥ÂàÜÊûê'},
  valuationTool:{en:'Valuation Tool',ko:'Í∞ÄÏπò Î∂ÑÏÑù',zh:'‰º∞ÂÄºÂ∑•ÂÖ∑',ja:'Ë©ï‰æ°„ÉÑ„Éº„É´'},
  licenseRef:{en:'License Ref',ko:'ÎùºÏù¥ÏÑºÏä§ Ï∞∏Ï°∞',zh:'ËÆ∏ÂèØÂèÇËÄÉ',ja:'„É©„Ç§„Çª„É≥„ÇπÂèÇÁÖß'},
  claimSummary:{en:'Claim Summary',ko:'Ï≤≠Íµ¨Ìï≠ ÏöîÏïΩ',zh:'ÊùÉÂà©Ë¶ÅÊ±ÇÊëòË¶Å',ja:'Ë´ãÊ±ÇÈ†ÖË¶ÅÁ¥Ñ'},
  independent:{en:'Independent',ko:'ÎèÖÎ¶ΩÌï≠',zh:'Áã¨Á´ãÊùÉÂà©Ë¶ÅÊ±Ç',ja:'Áã¨Á´ãÈ†Ö'},
  dependent:{en:'Dependent',ko:'Ï¢ÖÏÜçÌï≠',zh:'‰ªéÂ±ûÊùÉÂà©Ë¶ÅÊ±Ç',ja:'ÂæìÂ±ûÈ†Ö'},
  highRisk:{en:'HIGH RISK',ko:'Í≥†ÏúÑÌóò',zh:'È´òÈ£éÈô©',ja:'È´ò„É™„Çπ„ÇØ'},
  medRisk:{en:'MEDIUM RISK',ko:'Ï§ëÏúÑÌóò',zh:'‰∏≠È£éÈô©',ja:'‰∏≠„É™„Çπ„ÇØ'},
  lowRisk:{en:'LOW RISK',ko:'Ï†ÄÏúÑÌóò',zh:'‰ΩéÈ£éÈô©',ja:'‰Ωé„É™„Çπ„ÇØ'},
  products:{en:'products',ko:'Ï†úÌíà',zh:'‰∏™‰∫ßÂìÅ',ja:'Ë£ΩÂìÅ'},
  aiCompositeScore:{en:'AI Composite Score',ko:'AI Ï¢ÖÌï© Ï†êÏàò',zh:'AIÁªºÂêàËØÑÂàÜ',ja:'AIÁ∑èÂêà„Çπ„Ç≥„Ç¢'},
  aiFairValue:{en:'AI Fair Value Estimate',ko:'AI Ï†ÅÏ†ïÍ∞Ä Ï∂îÏ†ï',zh:'AIÂÖ¨ÂÖÅ‰ª∑ÂÄº‰º∞ÁÆó',ja:'AIÈÅ©Ê≠£‰æ°Ê†ºÊé®ÂÆö'},
  undervalued:{en:'Undervalued',ko:'Ï†ÄÌèâÍ∞Ä',zh:'‰Ωé‰º∞',ja:'Ââ≤ÂÆâ'},
  overvalued:{en:'Overvalued',ko:'Í≥†ÌèâÍ∞Ä',zh:'È´ò‰º∞',ja:'Ââ≤È´ò'},
  techStrength:{en:'Technical Strength',ko:'Í∏∞Ïà†Î†•',zh:'ÊäÄÊúØÂÆûÂäõ',ja:'ÊäÄË°ìÂäõ'},
  marketPotential:{en:'Market Potential',ko:'ÏãúÏû•ÏÑ±',zh:'Â∏ÇÂú∫ÊΩúÂäõ',ja:'Â∏ÇÂ†¥ÊÄß'},
  legalStability:{en:'Legal Stability',ko:'Í∂åÎ¶¨ÏïàÏ†ïÏÑ±',zh:'Ê≥ïÂæãÁ®≥ÂÆöÊÄß',ja:'Ê®©Âà©ÂÆâÂÆöÊÄß'},
  infrEvidence:{en:'Infringement Evidence',ko:'Ïπ®Ìï¥ ÏûÖÏ¶ù',zh:'‰æµÊùÉËØÅÊçÆ',ja:'‰æµÂÆ≥Á´ãË®º'},
  sepPremium:{en:'SEP Premium',ko:'ÌëúÏ§ÄÌäπÌóà ÌîÑÎ¶¨ÎØ∏ÏóÑ',zh:'Ê†áÂáÜ‰∏ìÂà©Ê∫¢‰ª∑',ja:'SEP„Éó„É¨„Éü„Ç¢„É†'},
  avgRoyaltyRate:{en:'Avg Royalty Rate',ko:'ÌèâÍ∑† Î°úÏó¥Ìã∞Ïú®',zh:'Âπ≥ÂùáËÆ∏ÂèØË¥πÁéá',ja:'Âπ≥Âùá„É≠„Ç§„É§„É™„ÉÜ„Ç£Áéá'},
  typicalLumpSum:{en:'Typical Lump Sum',ko:'ÏùºÎ∞òÏ†Å ÏùºÏãúÎ∂à',zh:'ÂÖ∏Âûã‰∏ÄÊ¨°ÊÄßË¥πÁî®',ja:'‰∏ÄËà¨ÁöÑ‰∏ÄÊôÇÈáë'},
  frandRange:{en:'FRAND Rate Range',ko:'FRAND ÏöîÏú®',zh:'FRANDË¥πÁéáËåÉÂõ¥',ja:'FRAND„É¨„Éº„ÉàÁØÑÂõ≤'},
  recentLicenseDeals:{en:'Recent License Deals',ko:'ÏµúÍ∑º ÎùºÏù¥ÏÑºÏä§ Í±∞Îûò',zh:'ÊúÄËøëËÆ∏ÂèØ‰∫§Êòì',ja:'ÊúÄËøë„ÅÆ„É©„Ç§„Çª„É≥„ÇπÂèñÂºï'},
  platformTxHistory:{en:'Platform Transaction History',ko:'ÌîåÎû´Ìèº Í±∞Îûò Ïù¥Î†•',zh:'Âπ≥Âè∞‰∫§ÊòìÂéÜÂè≤',ja:'„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†ÂèñÂºïÂ±•Ê≠¥'},
  agentHub:{en:'AI Agent Hub',ko:'AI ÏóêÏù¥Ï†ÑÌä∏ ÌóàÎ∏å',zh:'AI‰ª£ÁêÜ‰∏≠ÂøÉ',ja:'AI„Ç®„Éº„Ç∏„Çß„É≥„Éà„Éè„Éñ'},
  runAICycle:{en:'Run AI Cycle',ko:'AI ÏÇ¨Ïù¥ÌÅ¥ Ïã§Ìñâ',zh:'ËøêË°åAIÂë®Êúü',ja:'AI„Çµ„Ç§„ÇØ„É´ÂÆüË°å'},
  autoMatchAll:{en:'Auto-Match All',ko:'Ï†ÑÏ≤¥ ÏûêÎèô Îß§Ïπ≠',zh:'Ëá™Âä®ÂåπÈÖçÂÖ®ÈÉ®',ja:'ÂÖ®Ëá™Âãï„Éû„ÉÉ„ÉÅ„É≥„Ç∞'},
  matchResults:{en:'AI Match Results',ko:'AI Îß§Ïπ≠ Í≤∞Í≥º',zh:'AIÂåπÈÖçÁªìÊûú',ja:'AI„Éû„ÉÉ„ÉÅ„É≥„Ç∞ÁµêÊûú'},
  agentLog:{en:'Agent Activity Log',ko:'ÏóêÏù¥Ï†ÑÌä∏ ÌôúÎèô Î°úÍ∑∏',zh:'‰ª£ÁêÜÊ¥ªÂä®Êó•Âøó',ja:'„Ç®„Éº„Ç∏„Çß„É≥„ÉàÊ¥ªÂãï„É≠„Ç∞'},
  tradeRequest:{en:'Trade Request',ko:'Í±∞Îûò ÏöîÏ≤≠',zh:'‰∫§ÊòìËØ∑Ê±Ç',ja:'ÂèñÂºï„É™„ÇØ„Ç®„Çπ„Éà'},
  licenseRequest:{en:'License Request',ko:'ÎùºÏù¥ÏÑºÏä§ ÏöîÏ≤≠',zh:'ËÆ∏ÂèØËØ∑Ê±Ç',ja:'„É©„Ç§„Çª„É≥„Çπ„É™„ÇØ„Ç®„Çπ„Éà'},
  lumpSum:{en:'Lump Sum',ko:'ÏùºÏãúÎ∂à',zh:'‰∏ÄÊ¨°ÊÄß‰ªòÊ¨æ',ja:'‰∏ÄÊôÇÈáë'},
  runningRoyalty:{en:'Running Royalty',ko:'Îü¨ÎãùÎ°úÏó¥Ìã∞',zh:'ÊåÅÁª≠ËÆ∏ÂèØË¥π',ja:'„É©„É≥„Éã„É≥„Ç∞„É≠„Ç§„É§„É™„ÉÜ„Ç£'},
  submit:{en:'Submit',ko:'Ï†úÏ∂ú',zh:'Êèê‰∫§',ja:'ÈÄÅ‰ø°'},
  cancel:{en:'Cancel',ko:'Ï∑®ÏÜå',zh:'ÂèñÊ∂à',ja:'„Ç≠„É£„É≥„Çª„É´'},
  selectPatent:{en:'Select Patent',ko:'ÌäπÌóà ÏÑ†ÌÉù',zh:'ÈÄâÊã©‰∏ìÂà©',ja:'ÁâπË®±ÈÅ∏Êäû'},
  hoverDetails:{en:'Hover for details',ko:'ÎßàÏö∞Ïä§Î•º Ïò¨Î†§Î≥¥ÏÑ∏Ïöî',zh:'ÊÇ¨ÂÅúÊü•ÁúãËØ¶ÊÉÖ',ja:'„Éõ„Éê„Éº„ÅßË©≥Á¥∞Ë°®Á§∫'},
  manualEntry:{en:'Manual Entry',ko:'ÏßÅÏ†ë ÏûÖÎ†•',zh:'ÊâãÂä®ËæìÂÖ•',ja:'ÊâãÂãïÂÖ•Âäõ'},
  csvUpload:{en:'CSV Upload',ko:'ÌååÏùº ÏóÖÎ°úÎìú',zh:'CSV‰∏ä‰º†',ja:'CSV„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ'},
  register:{en:'Register',ko:'Îì±Î°ù',zh:'Ê≥®ÂÜå',ja:'ÁôªÈå≤'},
  owner:{en:'Owner',ko:'ÏÜåÏú†Ïûê',zh:'ÊâÄÊúâËÄÖ',ja:'ÊâÄÊúâËÄÖ'},
  field:{en:'Field',ko:'Î∂ÑÏïº',zh:'È¢ÜÂüü',ja:'ÂàÜÈáé'},
  filed:{en:'Filed',ko:'Ï∂úÏõêÏùº',zh:'Áî≥ËØ∑Êó•',ja:'Âá∫È°òÊó•'},
  description:{en:'Description',ko:'ÏÑ§Î™Ö',zh:'ÊèèËø∞',ja:'Ë™¨Êòé'},
  active:{en:'active',ko:'ÌôúÏÑ±',zh:'Ê¥ªË∑É',ja:'„Ç¢„ÇØ„ÉÜ„Ç£„Éñ'},
  guestNotice:{en:'You are browsing as Guest. Login to trade, license, or use AI agents.',ko:'Í≤åÏä§Ìä∏Î°ú ÎëòÎü¨Î≥¥Îäî Ï§ëÏûÖÎãàÎã§. Í±∞Îûò, ÎùºÏù¥ÏÑºÏã±, AI ÏóêÏù¥Ï†ÑÌä∏Î•º ÏÇ¨Ïö©ÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî.',zh:'ÊÇ®Ê≠£Âú®‰ª•ËÆøÂÆ¢Ë∫´‰ªΩÊµèËßà„ÄÇÁôªÂΩïÂêéÂèØËøõË°å‰∫§Êòì„ÄÅËÆ∏ÂèØÊàñ‰ΩøÁî®AI‰ª£ÁêÜ„ÄÇ',ja:'„Ç≤„Çπ„Éà„Å®„Åó„Å¶Èñ≤Ë¶ß‰∏≠„Åß„Åô„ÄÇÂèñÂºï„ÄÅ„É©„Ç§„Çª„É≥„Çπ„ÄÅAI„Ç®„Éº„Ç∏„Çß„É≥„Éà„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØ„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'}
};
function T(key){return (i18n[key]&&i18n[key][currentLang])||i18n[key]?.en||key;}

function setLang(lang){
  currentLang=lang;
  document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.lang-btn[onclick="setLang('${lang}')"]`)?.classList.add('active');
  document.getElementById('headerSubtext').textContent=T('headerSub');
  document.getElementById('registerBtn').textContent=T('registerPatent');
  document.getElementById('footerText').innerHTML=T('footer');
  if(currentUser)document.getElementById('userRoleLabel').textContent=T(currentRole);
  renderNav();
  ({dashboard:renderDashboard,patents:renderPatents,agents:renderAgents,chart:renderChartTab,value:renderValue,transactions:renderTransactions})[activeTab]?.();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// USER ROLES & STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ROLES={BUYER:{id:'buyer',label:'buyer',icon:'üõí',color:'#3b82f6'},SELLER:{id:'seller',label:'seller',icon:'üè∑Ô∏è',color:'#f97316'},LICENSOR:{id:'licensor',label:'licensor',icon:'üìú',color:'#8b5cf6'},LICENSEE:{id:'licensee',label:'licensee',icon:'üîë',color:'#10b981'},MONITOR:{id:'monitor',label:'monitor',icon:'üëÅÔ∏è',color:'#6b7280'},GUEST:{id:'guest',label:'guest',icon:'üåê',color:'#64748b'}};
let currentRole='buyer';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PATENT DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const patents=[
{id:"KR-2024-001234",title:"AI-Based Autonomous Driving Path Optimization",titleKr:"AI Í∏∞Î∞ò ÏûêÏú®Ï£ºÌñâ Í≤ΩÎ°ú ÏµúÏ†ÅÌôî",owner:"Samsung Electronics",ownerKr:"ÏÇºÏÑ±Ï†ÑÏûê",field:"AI",fieldKr:"Ïù∏Í≥µÏßÄÎä•",filingDate:"2024-03-15",status:"Granted",value:850000000,description:"Deep learning real-time autonomous driving path optimization.",descKr:"Îî•Îü¨Îãù ÏûêÏú®Ï£ºÌñâ Í≤ΩÎ°ú ÏµúÏ†ÅÌôî",claims:24,citedBy:15,remainingYears:17,techScore:92,marketScore:88,legalScore:95,isSEP:false,sepStandard:"",forSale:true,forLicense:true},
{id:"KR-2023-005678",title:"Quantum Cryptographic Communication Protocol",titleKr:"ÏñëÏûê ÏïîÌò∏Ìôî ÌÜµÏã† ÌîÑÎ°úÌÜ†ÏΩú",owner:"SK Telecom",ownerKr:"SKÌÖîÎ†àÏΩ§",field:"Security",fieldKr:"Î≥¥Ïïà/ÌÜµÏã†",filingDate:"2023-07-22",status:"Granted",value:1200000000,description:"QKD-based next-gen encrypted communication protocol.",descKr:"QKD Í∏∞Î∞ò Ï∞®ÏÑ∏ÎåÄ ÏïîÌò∏Ìôî ÌÜµÏã†",claims:18,citedBy:22,remainingYears:18,techScore:96,marketScore:82,legalScore:90,isSEP:true,sepStandard:"3GPP / ITU-T Q.810",forSale:true,forLicense:true},
{id:"KR-2024-009012",title:"Solid-State Battery Electrode Material",titleKr:"Í≥†Ï≤¥ Î∞∞ÌÑ∞Î¶¨ Ï†ÑÍ∑π ÏÜåÏû¨",owner:"LG Energy Solution",ownerKr:"LGÏóêÎÑàÏßÄÏÜîÎ£®ÏÖò",field:"Energy",fieldKr:"ÏóêÎÑàÏßÄ",filingDate:"2024-01-10",status:"Granted",value:2100000000,description:"Novel cathode for all-solid-state batteries, 2x density.",descKr:"Ï†ÑÍ≥†Ï≤¥ Î∞∞ÌÑ∞Î¶¨ ÏñëÍ∑πÏû¨",claims:32,citedBy:45,remainingYears:19,techScore:98,marketScore:95,legalScore:92,isSEP:false,sepStandard:"",forSale:false,forLicense:true},
{id:"KR-2023-003456",title:"Metaverse Spatial Rendering Engine",titleKr:"Î©îÌÉÄÎ≤ÑÏä§ Í≥µÍ∞Ñ Î†åÎçîÎßÅ ÏóîÏßÑ",owner:"Naver",ownerKr:"ÎÑ§Ïù¥Î≤Ñ",field:"Software",fieldKr:"ÏÜåÌîÑÌä∏Ïõ®Ïñ¥",filingDate:"2023-11-05",status:"Published",value:450000000,description:"Lightweight real-time 3D spatial rendering for mobile metaverse.",descKr:"Î™®Î∞îÏùº Î©îÌÉÄÎ≤ÑÏä§ 3D Î†åÎçîÎßÅ",claims:15,citedBy:8,remainingYears:18,techScore:78,marketScore:72,legalScore:85,isSEP:false,sepStandard:"",forSale:true,forLicense:true},
{id:"KR-2024-007890",title:"Genomic Biomarker Analysis Platform",titleKr:"Ïú†Ï†ÑÏ≤¥ Î∞îÏù¥Ïò§ÎßàÏª§ ÌîåÎû´Ìèº",owner:"Celltrion",ownerKr:"ÏÖÄÌä∏Î¶¨Ïò®",field:"Bio",fieldKr:"Î∞îÏù¥Ïò§",filingDate:"2024-05-20",status:"Granted",value:1750000000,description:"NGS-based multi-biomarker detection for cancer diagnosis.",descKr:"NGS Í∏∞Î∞ò Îã§Ï§ë Î∞îÏù¥Ïò§ÎßàÏª§ Í≤ÄÏ∂ú",claims:28,citedBy:35,remainingYears:19,techScore:94,marketScore:91,legalScore:88,isSEP:false,sepStandard:"",forSale:true,forLicense:true},
{id:"KR-2023-002345",title:"Smart Factory Digital Twin",titleKr:"Ïä§ÎßàÌä∏ Ìå©ÌÜ†Î¶¨ ÎîîÏßÄÌÑ∏ Ìä∏Ïúà",owner:"Hyundai Heavy",ownerKr:"ÌòÑÎåÄÏ§ëÍ≥µÏóÖ",field:"Manufacturing",fieldKr:"Ï†úÏ°∞/IoT",filingDate:"2023-09-12",status:"Granted",value:680000000,description:"Digital twin simulating entire manufacturing processes.",descKr:"Ï†úÏ°∞ Í≥µÏ†ï ÎîîÏßÄÌÑ∏ Ìä∏Ïúà",claims:20,citedBy:12,remainingYears:17,techScore:85,marketScore:80,legalScore:90,isSEP:false,sepStandard:"",forSale:true,forLicense:false},
{id:"KR-2024-004567",title:"6G Antenna Array Design",titleKr:"6G ÏïàÌÖåÎÇò Ïñ¥Î†àÏù¥ ÏÑ§Í≥Ñ",owner:"KT Corporation",ownerKr:"KT",field:"Telecom",fieldKr:"ÌÜµÏã†",filingDate:"2024-02-28",status:"Under Review",value:950000000,description:"Terahertz band compact antenna array for 6G.",descKr:"ÌÖåÎùºÌó§Î•¥Ï∏† 6G ÏïàÌÖåÎÇò",claims:22,citedBy:18,remainingYears:19,techScore:90,marketScore:76,legalScore:82,isSEP:true,sepStandard:"3GPP Release 20",forSale:false,forLicense:true},
{id:"KR-2023-008901",title:"Carbon Capture Catalyst Technology",titleKr:"ÌÉÑÏÜå Ìè¨Ïßë Ï¥âÎß§ Í∏∞Ïà†",owner:"POSCO",ownerKr:"Ìè¨Ïä§ÏΩî",field:"Environment",fieldKr:"ÌôòÍ≤Ω/ÏóêÎÑàÏßÄ",filingDate:"2023-06-30",status:"Granted",value:1350000000,description:"CO2 capture and conversion to high-value chemicals.",descKr:"CO2 Ìè¨Ïßë Î∞è ÌôîÌïôÏõêÎ£å Ï†ÑÌôò Ï¥âÎß§",claims:26,citedBy:30,remainingYears:18,techScore:88,marketScore:93,legalScore:87,isSEP:false,sepStandard:"",forSale:true,forLicense:true},
{id:"US-2024-031245",title:"5G NR MIMO Beamforming Method",titleKr:"5G NR MIMO ÎπîÌè¨Î∞ç",owner:"Qualcomm",ownerKr:"ÌÄÑÏª¥",field:"Telecom",fieldKr:"ÌÜµÏã†",filingDate:"2024-04-12",status:"Granted",value:3200000000,description:"Essential MIMO beamforming for 5G NR standard.",descKr:"5G NR ÌïÑÏàò MIMO ÎπîÌè¨Î∞ç",claims:35,citedBy:58,remainingYears:19,techScore:97,marketScore:96,legalScore:94,isSEP:true,sepStandard:"3GPP TS 38.214",forSale:true,forLicense:true},
{id:"EP-2023-087654",title:"Wi-Fi 7 Channel Access Protocol",titleKr:"Wi-Fi 7 Ï±ÑÎÑê Ï†ëÍ∑º ÌîÑÎ°úÌÜ†ÏΩú",owner:"Intel Corporation",ownerKr:"Ïù∏ÌÖî",field:"Telecom",fieldKr:"ÌÜµÏã†",filingDate:"2023-08-15",status:"Granted",value:1850000000,description:"MLO channel access for IEEE 802.11be Wi-Fi 7.",descKr:"IEEE 802.11be Wi-Fi 7 MLO Ï±ÑÎÑê Ï†ëÍ∑º",claims:29,citedBy:42,remainingYears:18,techScore:93,marketScore:90,legalScore:91,isSEP:true,sepStandard:"IEEE 802.11be",forSale:false,forLicense:true}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXTENDED DATA: Claims, Infringement, License Refs
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const patentClaims={
"KR-2024-001234":{summary:"A system for autonomous vehicle path optimization using deep neural network inference on real-time sensor data with multi-objective route planning.",claims:[{num:1,type:'ind',text:"A method for optimizing autonomous driving paths comprising: receiving real-time sensor data from LiDAR, camera, and radar sensors; processing said data through a deep neural network trained on traffic patterns; generating a multi-objective optimized route considering safety, efficiency, and passenger comfort; and dynamically adjusting the route in response to changing road conditions.",keywords:['deep neural network','LiDAR','multi-objective','real-time']},{num:2,type:'dep',text:"The method of claim 1, wherein the deep neural network comprises a transformer-based architecture with attention mechanisms for prioritizing sensor inputs based on driving context.",keywords:['transformer','attention mechanism']},{num:3,type:'dep',text:"The method of claim 1, further comprising a reinforcement learning module that continuously improves path optimization based on historical driving outcomes.",keywords:['reinforcement learning','historical data']},{num:10,type:'ind',text:"An autonomous driving system comprising: a sensor fusion module; a path optimization processor implementing claims 1-3; and a vehicle control interface for executing optimized paths.",keywords:['sensor fusion','vehicle control','system']}]},
"KR-2023-005678":{summary:"A quantum key distribution protocol enabling unconditionally secure communication channels through entangled photon pair transmission and real-time key reconciliation.",claims:[{num:1,type:'ind',text:"A quantum cryptographic communication protocol comprising: generating entangled photon pairs using a parametric down-conversion source; distributing photons through a quantum channel; performing Bell-state measurements at receiver nodes; and executing real-time key reconciliation with error correction using LDPC codes.",keywords:['entangled photon','Bell-state','LDPC','QKD']},{num:5,type:'ind',text:"A network architecture for quantum key distribution comprising: multiple quantum repeater nodes; a classical channel for key reconciliation; and a key management server implementing post-quantum cryptographic backup.",keywords:['quantum repeater','key management','post-quantum']},{num:8,type:'dep',text:"The protocol of claim 1, wherein the error correction achieves a secure key rate of at least 1 Mbps over a fiber distance of 100 km.",keywords:['key rate','fiber distance','100km']}]},
"KR-2024-009012":{summary:"A novel cathode active material composition for all-solid-state batteries using sulfide-based solid electrolyte with lithium-rich layered oxide structure.",claims:[{num:1,type:'ind',text:"A cathode active material for solid-state batteries comprising: a lithium-rich layered oxide having the formula Li[Li_xNi_yMn_zCo_w]O2; coated with a sulfide-based solid electrolyte layer of thickness 2-10nm; wherein the coating provides ionic conductivity of at least 10^-3 S/cm at room temperature.",keywords:['lithium-rich','sulfide electrolyte','ionic conductivity','layered oxide']},{num:2,type:'dep',text:"The material of claim 1, wherein the sulfide-based solid electrolyte comprises Li6PS5Cl (argyrodite) with halide substitution.",keywords:['argyrodite','Li6PS5Cl','halide']},{num:15,type:'ind',text:"A method for manufacturing the cathode material of claim 1 comprising: wet-chemical synthesis of the lithium-rich oxide; atomic layer deposition of the sulfide coating; and heat treatment at 200-400C under inert atmosphere.",keywords:['ALD','wet-chemical','heat treatment']}]},
"KR-2023-003456":{summary:"A lightweight 3D spatial rendering engine optimized for mobile AR/VR using level-of-detail mesh streaming and neural radiance field compression.",claims:[{num:1,type:'ind',text:"A rendering engine for metaverse applications comprising: a progressive mesh streaming module that adapts geometry complexity based on device capability and network bandwidth; a neural radiance field (NeRF) compression codec; and a real-time lighting system using spherical harmonics.",keywords:['NeRF','progressive mesh','spherical harmonics','streaming']},{num:7,type:'ind',text:"A method of rendering 3D spaces on mobile devices comprising: receiving compressed NeRF representations; decompressing using a lightweight neural decoder; and rendering at minimum 60fps on devices with GPU compute capability of 1 TFLOPS or greater.",keywords:['60fps','mobile GPU','neural decoder']}]},
"KR-2024-007890":{summary:"A multi-biomarker simultaneous detection platform using targeted NGS panel with AI-driven variant calling for early-stage cancer diagnosis.",claims:[{num:1,type:'ind',text:"A genomic analysis platform comprising: a targeted NGS panel covering at least 500 cancer-associated genes; a machine learning variant caller trained on >100,000 tumor-normal pairs; a multi-biomarker fusion algorithm integrating SNV, CNV, fusion, and MSI signals; and a clinical report generator with evidence-level classification.",keywords:['NGS panel','variant calling','biomarker fusion','MSI']},{num:3,type:'dep',text:"The platform of claim 1, wherein the machine learning variant caller achieves sensitivity >=99.5% and specificity >=99.9% for SNVs at >=5% variant allele frequency.",keywords:['sensitivity','specificity','VAF']},{num:12,type:'ind',text:"A method for early cancer detection comprising: extracting cell-free DNA from a blood sample; performing targeted sequencing using the panel of claim 1; and classifying cancer type and stage using a multi-class neural network.",keywords:['cfDNA','liquid biopsy','cancer classification']}]},
"KR-2023-002345":{summary:"A digital twin system for manufacturing processes using real-time IoT sensor data, physics-based simulation, and predictive maintenance AI.",claims:[{num:1,type:'ind',text:"A digital twin system for smart factories comprising: IoT sensor data collection from manufacturing equipment at >=1kHz sampling rate; a physics-based simulation engine modeling mechanical, thermal, and electrical processes; and a predictive maintenance module using LSTM networks for failure prediction.",keywords:['IoT sensors','physics simulation','LSTM','predictive maintenance']},{num:5,type:'dep',text:"The system of claim 1, wherein the predictive maintenance module provides failure prediction with >=95% accuracy at least 24 hours before equipment failure.",keywords:['failure prediction','95% accuracy','24 hours']}]},
"KR-2024-004567":{summary:"A compact terahertz antenna array design for 6G communications using metasurface-based beam steering and reconfigurable intelligent surface integration.",claims:[{num:1,type:'ind',text:"An antenna array for terahertz communication comprising: a planar array of at least 256 antenna elements operating in the 100-300 GHz band; a metasurface layer providing continuous beam steering over +/-60 deg; and a reconfigurable intelligent surface (RIS) module for non-line-of-sight coverage enhancement.",keywords:['terahertz','metasurface','RIS','beam steering','256 elements']},{num:4,type:'dep',text:"The antenna of claim 1, achieving a minimum effective isotropic radiated power (EIRP) of 30 dBm and beam switching time of less than 1 microsecond.",keywords:['EIRP','beam switching','30dBm']},{num:10,type:'ind',text:"A method of 6G signal transmission using the array of claim 1 comprising: AI-based channel estimation; codebook-free beam management; and multi-user MIMO with at least 16 spatial streams.",keywords:['AI channel estimation','codebook-free','16 streams']}]},
"KR-2023-008901":{summary:"A catalytic system for capturing industrial CO2 and converting it to methanol and other C1 chemicals using copper-zinc oxide nanostructured catalysts.",claims:[{num:1,type:'ind',text:"A catalyst for CO2 capture and conversion comprising: a nanostructured copper-zinc oxide composite with particle size 5-20nm; supported on mesoporous alumina with pore size 3-10nm; achieving CO2 conversion rate >=85% and methanol selectivity >=90% at temperatures 200-300C and pressures 20-50 bar.",keywords:['Cu-ZnO','nanostructured','methanol','CO2 conversion']},{num:6,type:'ind',text:"A process for converting captured CO2 to methanol comprising: absorbing CO2 using amine-functionalized sorbent; desorbing CO2 at 120C; and catalytically converting using the catalyst of claim 1 in a fixed-bed reactor.",keywords:['amine sorbent','fixed-bed reactor','desorption']}]},
"US-2024-031245":{summary:"A MIMO beamforming method for 5G NR using codebook-based and non-codebook-based precoding with dynamic rank adaptation for massive MIMO systems.",claims:[{num:1,type:'ind',text:"A method of beamforming in a 5G NR system comprising: receiving channel state information (CSI) from a user equipment; selecting between Type I and Type II codebook-based precoding based on channel rank and coherence time; generating precoding matrix indicators (PMI) for up to 32 antenna ports; and performing dynamic rank adaptation for massive MIMO with at least 64 transmit antennas.",keywords:['CSI','PMI','Type II codebook','massive MIMO','rank adaptation']},{num:5,type:'dep',text:"The method of claim 1, further comprising non-codebook-based precoding using SRS-based reciprocity for TDD systems with channel estimation accuracy >=95%.",keywords:['SRS reciprocity','TDD','non-codebook']},{num:12,type:'ind',text:"A base station apparatus implementing the method of claim 1, comprising: a baseband processing unit; an antenna array with at least 64 cross-polarized elements; and a beam management controller supporting up to 64 simultaneous beams per cell.",keywords:['base station','64 elements','beam management','cross-polarized']}]},
"EP-2023-087654":{summary:"A Multi-Link Operation (MLO) channel access protocol for Wi-Fi 7 enabling simultaneous transmission across multiple frequency bands with enhanced QoS.",claims:[{num:1,type:'ind',text:"A channel access method for IEEE 802.11be comprising: establishing multi-link operation across at least two frequency bands selected from 2.4 GHz, 5 GHz, and 6 GHz; performing simultaneous transmit and receive (STR) operations with inter-link interference management; and applying traffic-ID (TID) to link mapping for QoS-aware load balancing.",keywords:['MLO','STR','TID mapping','multi-band','QoS']},{num:3,type:'dep',text:"The method of claim 1, wherein the inter-link interference management uses a coordinated spatial reuse algorithm achieving >=30% throughput improvement over single-link operation.",keywords:['spatial reuse','30% throughput','coordinated']},{num:8,type:'ind',text:"A Wi-Fi 7 access point implementing claim 1, comprising: at least three radio chains; a MLO controller with sub-millisecond link switching; and a 4096-QAM modulation engine with 320 MHz channel bandwidth support.",keywords:['4096-QAM','320MHz','3 radios','link switching']}]}
};

const infringementData={
"KR-2024-001234":[{product:"Waymo Driver 6th Gen",company:"Waymo (Alphabet)",risk:"high",detail:"Uses transformer-based path planning with multi-sensor fusion. Claim 1 & 10 overlap.",matchClaims:[1,10],evidence:"Published paper CVPR 2025 describes similar approach."},{product:"Tesla FSD v13",company:"Tesla Inc.",risk:"medium",detail:"Vision-only approach differs but RL path optimization (Claim 3) shows similarity.",matchClaims:[3],evidence:"FSD Beta release notes reference RL-based path planning."},{product:"Apollo RT6",company:"Baidu",risk:"low",detail:"Uses traditional HD-map based routing with some sensor fusion overlap.",matchClaims:[10],evidence:"Technical documentation available."}],
"KR-2023-005678":[{product:"QKD-600 Network",company:"ID Quantique",risk:"medium",detail:"Commercial QKD system using entangled photon pairs. LDPC error correction may overlap.",matchClaims:[1],evidence:"Product datasheet shows similar protocol."},{product:"Quantum Xchange PhiO",company:"Quantum Xchange",risk:"low",detail:"Different key distribution approach using trusted relay nodes.",matchClaims:[5],evidence:"Whitepaper available."}],
"KR-2024-009012":[{product:"AION Battery Cell",company:"CATL",risk:"high",detail:"Solid-state battery using sulfide electrolyte coating on Ni-rich cathode. Core method overlap.",matchClaims:[1,2],evidence:"Patent filing shows similar composition range."},{product:"All-Solid EV Battery",company:"Toyota",risk:"medium",detail:"Similar coating approach with different cathode chemistry.",matchClaims:[15],evidence:"CES 2026 presentation materials."},{product:"Ultium SS Gen2",company:"Samsung SDI",risk:"medium",detail:"Li-rich cathode with solid electrolyte interface layer.",matchClaims:[1,2],evidence:"Published journal article in Nature Energy."}],
"KR-2023-003456":[{product:"Meta Horizon Worlds Engine",company:"Meta Platforms",risk:"medium",detail:"Uses NeRF-based rendering and progressive mesh streaming.",matchClaims:[1],evidence:"Developer conference presentation 2025."},{product:"Unity MARS",company:"Unity Technologies",risk:"low",detail:"Different rendering pipeline but mobile optimization has similarity.",matchClaims:[7],evidence:"SDK documentation."}],
"KR-2024-007890":[{product:"FoundationOne CDx",company:"Foundation Medicine (Roche)",risk:"medium",detail:"Targeted NGS panel with 324 genes. Multi-biomarker fusion algorithm similarity.",matchClaims:[1],evidence:"FDA PMA supplement documentation."},{product:"Guardant360 CDx",company:"Guardant Health",risk:"high",detail:"cfDNA liquid biopsy platform. Claim 12 directly relevant.",matchClaims:[12,1],evidence:"Published clinical trial data in NEJM."}],
"KR-2023-002345":[{product:"Siemens Xcelerator Digital Twin",company:"Siemens AG",risk:"medium",detail:"Physics-based simulation with IoT integration. Core architecture overlap.",matchClaims:[1],evidence:"Product documentation and demo."},{product:"PTC ThingWorx",company:"PTC Inc.",risk:"low",detail:"IoT platform with predictive analytics but different simulation approach.",matchClaims:[5],evidence:"Technical whitepaper."}],
"KR-2024-004567":[{product:"6G THz Prototype",company:"Samsung Research",risk:"medium",detail:"Demonstrated terahertz MIMO at MWC 2026. Metasurface approach may overlap.",matchClaims:[1,4],evidence:"MWC 2026 demo and press release."},{product:"RIS-Aided 6G Module",company:"Huawei",risk:"high",detail:"RIS-integrated antenna for sub-THz band. Strong overlap with metasurface + RIS combination.",matchClaims:[1,10],evidence:"3GPP RAN1 contribution documents."}],
"KR-2023-008901":[{product:"Carbon Recycling Methanol Plant",company:"Carbon Recycling Intl",risk:"medium",detail:"CO2-to-methanol process using Cu/ZnO catalyst. Composition overlap.",matchClaims:[1],evidence:"Published plant performance data."},{product:"eREACT Modular Unit",company:"BASF",risk:"low",detail:"Different catalyst approach but fixed-bed reactor process similarity.",matchClaims:[6],evidence:"Patent filings in EU."}],
"US-2024-031245":[{product:"All 5G NR Base Stations",company:"Multiple Vendors",risk:"high",detail:"As declared SEP, all 5G NR implementations must use this method.",matchClaims:[1,5,12],evidence:"3GPP standard specification mandates this method."},{product:"Dimensity 9400 Modem",company:"MediaTek",risk:"high",detail:"5G modem implementing 3GPP Rel-17 MIMO.",matchClaims:[1,5],evidence:"3GPP compliance certification."},{product:"Exynos 2600 Modem",company:"Samsung LSI",risk:"high",detail:"5G NR modem with massive MIMO support.",matchClaims:[1,12],evidence:"Product specification sheet."}],
"EP-2023-087654":[{product:"All Wi-Fi 7 Certified Devices",company:"Multiple Vendors",risk:"high",detail:"As declared SEP, all Wi-Fi 7 devices implementing MLO must use this protocol.",matchClaims:[1,3,8],evidence:"IEEE 802.11be standard specification."},{product:"Qualcomm FastConnect 7900",company:"Qualcomm",risk:"high",detail:"Wi-Fi 7 chipset with MLO and 4096-QAM.",matchClaims:[1,8],evidence:"Wi-Fi Alliance certification documents."},{product:"Broadcom BCM4398",company:"Broadcom",risk:"high",detail:"Wi-Fi 7 SoC supporting tri-band MLO with STR operations.",matchClaims:[1,3],evidence:"Product brief and certification."}]
};

const licenseRefData={
"KR-2024-001234":{avgRate:3.2,typicalLump:500000000,recentDeals:[{licensee:"Hyundai Motor",type:"Running Royalty",rate:"2.8%",date:"2025-09",amount:null},{licensee:"BMW AG",type:"Lump Sum",rate:null,date:"2025-06",amount:620000000}],frandRate:null,comparable:"Average AI/autonomous driving patent royalty: 2-5% of module price"},
"KR-2023-005678":{avgRate:2.5,typicalLump:300000000,recentDeals:[{licensee:"Kakao",type:"Running Royalty",rate:"2.0%",date:"2026-01",amount:null}],frandRate:"1.5-3.0%",comparable:"Telecom security patent FRAND range: 1.0-3.5%"},
"KR-2024-009012":{avgRate:4.0,typicalLump:1200000000,recentDeals:[{licensee:"CATL",type:"Lump Sum + Royalty",rate:"3.5%",date:"2026-02",amount:300000000},{licensee:"Panasonic",type:"Lump Sum",rate:null,date:"2025-11",amount:980000000}],frandRate:null,comparable:"Battery material patents: 3-6% of cell price"},
"KR-2023-003456":{avgRate:2.0,typicalLump:150000000,recentDeals:[],frandRate:null,comparable:"Software rendering engine: 1-3% of revenue or per-device fee"},
"KR-2024-007890":{avgRate:5.5,typicalLump:900000000,recentDeals:[{licensee:"Roche Diagnostics",type:"Running Royalty",rate:"5.0%",date:"2025-10",amount:null}],frandRate:null,comparable:"Diagnostic platform patents: 4-8% of test revenue"},
"KR-2023-002345":{avgRate:2.5,typicalLump:250000000,recentDeals:[],frandRate:null,comparable:"Industrial IoT/digital twin: 2-4% of software license"},
"KR-2024-004567":{avgRate:3.0,typicalLump:400000000,recentDeals:[],frandRate:"0.5-2.0%",comparable:"6G antenna SEP FRAND (estimated): 0.5-2.0% of device price"},
"KR-2023-008901":{avgRate:3.5,typicalLump:700000000,recentDeals:[{licensee:"BASF",type:"Lump Sum",rate:null,date:"2025-08",amount:450000000}],frandRate:null,comparable:"Green tech catalyst: 3-5% of process revenue"},
"US-2024-031245":{avgRate:2.0,typicalLump:2000000000,recentDeals:[{licensee:"Samsung Electronics",type:"Cross-License + Royalty",rate:"1.8%",date:"2026-01",amount:1500000000},{licensee:"Apple Inc.",type:"Running Royalty",rate:"2.25%",date:"2025-07",amount:null},{licensee:"Huawei",type:"Lump Sum",rate:null,date:"2025-05",amount:2800000000}],frandRate:"1.5-2.5%",comparable:"5G NR SEP pool rate: ~$1.50-3.00 per handset"},
"EP-2023-087654":{avgRate:1.5,typicalLump:1000000000,recentDeals:[{licensee:"Qualcomm",type:"Cross-License",rate:"1.2%",date:"2025-12",amount:null},{licensee:"MediaTek",type:"Running Royalty",rate:"1.5%",date:"2025-09",amount:null}],frandRate:"0.8-2.0%",comparable:"Wi-Fi SEP licensing: $0.50-2.00 per device"}
};

let transactions=[];
let activityFeed=[];
let currentPatent=null;let chartInstances={};let ohlcCache={};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI AGENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const aiAgents=[
{id:'agent-alpha',name:'AlphaPatent AI',avatar:'ü§ñ',bg:'rgba(59,130,246,.1)',role:'buyer',strategy:'aggressive',budget:5e9,spent:0,interests:['Telecom','AI','Security'],minScore:80,maxPerDeal:2e9,royPref:'running',maxRoyRate:5,active:true,deals:0,desc:'Telecom & AI patent acquisition specialist. Aggressive bidding on high-value SEP.'},
{id:'agent-beta',name:'BetaLicense AI',avatar:'üß†',bg:'rgba(16,185,129,.1)',role:'licensee',strategy:'balanced',budget:2e9,spent:0,interests:['Energy','Bio','Environment'],minScore:75,maxPerDeal:5e8,royPref:'lumpsum',maxRoyRate:3.5,active:true,deals:0,desc:'Licensing specialist for green tech & biotech patents. Balanced approach.'},
{id:'agent-gamma',name:'GammaSeller AI',avatar:'‚ö°',bg:'rgba(245,158,11,.1)',role:'seller',strategy:'conservative',budget:0,spent:0,interests:['Software','Manufacturing','AI'],minScore:0,maxPerDeal:0,royPref:'',maxRoyRate:0,active:true,deals:0,desc:'Optimizes patent sale timing using market trend analysis. Conservative pricing.'},
{id:'agent-delta',name:'DeltaBroker AI',avatar:'üîÑ',bg:'rgba(139,92,246,.1)',role:'broker',strategy:'balanced',budget:10e9,spent:0,interests:['Telecom','Energy','AI','Security','Bio'],minScore:70,maxPerDeal:3e9,royPref:'running',maxRoyRate:4,active:true,deals:0,desc:'Full-service broker matching buyers & sellers. Cross-industry deal facilitation.'},
{id:'agent-omega',name:'OmegaMonitor AI',avatar:'üìä',bg:'rgba(100,116,139,.1)',role:'monitor',strategy:'conservative',budget:0,spent:0,interests:['Telecom','AI','Energy','Bio','Security','Software','Manufacturing','Environment'],minScore:0,maxPerDeal:0,royPref:'',maxRoyRate:0,active:true,deals:0,desc:'Market surveillance & patent valuation analyst. Provides alerts and insights.'}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fUSD(v){if(v>=1e9)return'$'+(v/1e9).toFixed(2)+'B';if(v>=1e6)return'$'+(v/1e6).toFixed(1)+'M';if(v>=1e3)return'$'+(v/1e3).toFixed(0)+'K';return'$'+v;}
function fKRW(v){if(v>=1e8)return(v/1e8).toFixed(1)+'ÏñµÏõê';if(v>=1e4)return(v/1e4).toFixed(0)+'ÎßåÏõê';return v+'Ïõê';}
function fKRW2(v){if(v>=1e8)return(v/1e8).toFixed(2)+'Ïñµ';if(v>=1e4)return(v/1e4).toFixed(0)+'Îßå';return v+'';}
function fVal(v){return fUSD(v)+' <span style="color:var(--text-muted);font-size:.8em">('+fKRW(v)+')</span>';}
function badge(t,c){return`<span class="badge badge-${c}">${t}</span>`;}
function statusBadge(s){return badge(s,{Granted:'green',Published:'blue','Under Review':'amber'}[s]||'gray');}
function sepBadge(p){return p.isSEP?`<span class="badge-sep">SEP</span>`:'';}
function sepInd(p){return p.isSEP?`<div class="sep-indicator">‚òÖ SEP${p.sepStandard?' ‚Äî '+p.sepStandard:''}</div>`:'';}
function typeBadge(t){return badge(t,t==='Trade'?'purple':'blue');}
function txBadge(s){return badge(s,{Completed:'green','In Progress':'amber',Negotiating:'gray',Rejected:'red','AI Auto':'purple'}[s]||'gray');}
function roleBadge(r){const m={buyer:'blue',seller:'amber',licensor:'purple',licensee:'green',broker:'purple',monitor:'gray',guest:'gray'};return badge(r,m[r]||'gray');}
function notify(m,t='success'){const e=document.getElementById('notification');e.textContent=m;e.className=`notification ${t} show`;setTimeout(()=>e.className='notification',3500);}
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
function destroyChart(n){if(chartInstances[n]){chartInstances[n].destroy();delete chartInstances[n];}}
function updateTV(){document.getElementById('totalValue').textContent=fUSD(patents.reduce((s,p)=>s+p.value,0));}
function timeAgo(d){const s=Math.floor((Date.now()-d)/1000);if(s<60)return s+'s ago';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago';}
function addFeed(icon,bg,title,desc,agentId){activityFeed.unshift({icon,bg,title,desc,time:Date.now(),agentId});if(activityFeed.length>100)activityFeed.pop();}
function isGuest(){return currentRole==='guest';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OHLC & CANDLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function genOHLC(bv,days,seed){const d=[];let pr=bv/1e8;const rng=s=>{s=Math.sin(s)*10000;return s-Math.floor(s);};for(let i=0;i<days;i++){const r1=rng(seed+i*7.3),r2=rng(seed+i*13.7+100),r3=rng(seed+i*23.1+200),r4=rng(seed+i*37.9+300);const ch=(r1-.48)*pr*.06;const o=pr,c=pr+ch;const h=Math.max(o,c)+Math.abs(r2*pr*.025);const l=Math.min(o,c)-Math.abs(r3*pr*.025);const v=Math.floor(50+r4*200);const dt=new Date(2026,1,8);dt.setDate(dt.getDate()-(days-i));d.push({date:dt,open:+o.toFixed(2),high:+h.toFixed(2),low:+l.toFixed(2),close:+c.toFixed(2),volume:v});pr=c;}return d;}
function aggOHLC(daily,period){if(period==='daily')return daily;const g={};daily.forEach(d=>{let k;if(period==='weekly'){const sw=new Date(d.date);sw.setDate(d.date.getDate()-d.date.getDay());k=sw.toISOString().slice(0,10);}else k=d.date.getFullYear()+'-'+String(d.date.getMonth()+1).padStart(2,'0');if(!g[k])g[k]=[];g[k].push(d);});return Object.values(g).map(x=>({date:x[0].date,open:x[0].open,high:Math.max(...x.map(d=>d.high)),low:Math.min(...x.map(d=>d.low)),close:x[x.length-1].close,volume:x.reduce((s,d)=>s+d.volume,0)}));}
function getOHLC(p){if(!ohlcCache[p.id]){const s=p.id.split('').reduce((a,c)=>a+c.charCodeAt(0),0);ohlcCache[p.id]=genOHLC(p.value,365,s);}return ohlcCache[p.id];}
function calcMA(d,p){return d.map((x,i)=>i<p-1?null:+(d.slice(i-p+1,i+1).reduce((s,v)=>s+v.close,0)/p).toFixed(2));}
function drawCandle(cid,data,opts={}){const cv=document.getElementById(cid);if(!cv)return;const ctx=cv.getContext('2d');const dpr=window.devicePixelRatio||1;const W=cv.parentElement.getBoundingClientRect().width;const H=opts.height||400;cv.width=W*dpr;cv.height=H*dpr;cv.style.width=W+'px';cv.style.height=H+'px';ctx.scale(dpr,dpr);if(!data||!data.length)return;const pad={top:10,right:65,bottom:50,left:10};const cH=H-pad.top-pad.bottom;const vH=cH*.18;const pH=cH-vH-8;const prices=data.flatMap(d=>[d.high,d.low]);let minP=Math.min(...prices),maxP=Math.max(...prices);const pR=maxP-minP||1;minP-=pR*.05;maxP+=pR*.05;const maxV=Math.max(...data.map(d=>d.volume));const cW=Math.max(2,Math.min(12,(W-pad.left-pad.right)/data.length*.7));const gap=(W-pad.left-pad.right)/data.length;const pY=p=>pad.top+pH-((p-minP)/(maxP-minP))*pH;const vY=v=>pad.top+pH+8+vH-(v/maxV)*vH;const cX=i=>pad.left+gap*i+gap/2;ctx.fillStyle='#0f1724';ctx.fillRect(0,0,W,H);ctx.strokeStyle='#1e293b';ctx.lineWidth=.5;for(let i=0;i<=5;i++){const y=pad.top+(pH/5)*i;ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(W-pad.right,y);ctx.stroke();ctx.fillStyle='#64748b';ctx.font='9px sans-serif';ctx.textAlign='left';ctx.fillText(fKRW2((maxP-((maxP-minP)/5)*i)*1e8),W-pad.right+4,y+3);}data.forEach((d,i)=>{const x=cX(i);ctx.fillStyle=d.close>=d.open?'rgba(34,197,94,.2)':'rgba(239,68,68,.2)';const vy=vY(d.volume);ctx.fillRect(x-cW/2,vy,cW,pad.top+pH+8+vH-vy);});const ma5=calcMA(data,5),ma20=calcMA(data,20),ma60=calcMA(data,Math.min(60,data.length));[[ma5,'#f59e0b'],[ma20,'#3b82f6'],[ma60,'#ec4899']].forEach(([ma,col])=>{ctx.strokeStyle=col;ctx.lineWidth=1;ctx.beginPath();let st=false;ma.forEach((v,i)=>{if(v===null)return;const x=cX(i),y=pY(v);if(!st){ctx.moveTo(x,y);st=true;}else ctx.lineTo(x,y);});ctx.stroke();});data.forEach((d,i)=>{const x=cX(i);const up=d.close>=d.open;const col=up?'#22c55e':'#ef4444';ctx.strokeStyle=col;ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(x,pY(d.high));ctx.lineTo(x,pY(d.low));ctx.stroke();const bT=pY(Math.max(d.open,d.close)),bB=pY(Math.min(d.open,d.close)),bH=Math.max(1,bB-bT);if(up){ctx.strokeStyle=col;ctx.lineWidth=1;ctx.strokeRect(x-cW/2,bT,cW,bH);}else{ctx.fillStyle=col;ctx.fillRect(x-cW/2,bT,cW,bH);}});ctx.fillStyle='#64748b';ctx.font='8px sans-serif';ctx.textAlign='center';const step=Math.max(1,Math.floor(data.length/8));data.forEach((d,i)=>{if(i%step===0)ctx.fillText((d.date.getMonth()+1)+'/'+d.date.getDate(),cX(i),H-pad.bottom+14);});cv._ohlcData=data;cv._meta={pad,pH,vH,gap,cX,pY,W,H,minP,maxP,maxV};}
function setupHover(cid,iid){const cv=document.getElementById(cid);if(!cv)return;cv.addEventListener('mousemove',e=>{const r=cv.getBoundingClientRect();const mx=e.clientX-r.left;const d=cv._ohlcData,m=cv._meta;if(!d||!m)return;const idx=Math.round((mx-m.pad.left-m.gap/2)/m.gap);if(idx<0||idx>=d.length)return;const x=d[idx];const up=x.close>=x.open;const ch=((x.close-x.open)/x.open*100).toFixed(2);const dt=x.date;const ds=dt.getFullYear()+'.'+String(dt.getMonth()+1).padStart(2,'0')+'.'+String(dt.getDate()).padStart(2,'0');const cl=up?'up':'down';const info=document.getElementById(iid);if(info)info.innerHTML=`<span>${ds}</span><span>O <span class="${cl}">${fKRW2(x.open*1e8)}</span></span><span>H <span class="${cl}">${fKRW2(x.high*1e8)}</span></span><span>L <span class="${cl}">${fKRW2(x.low*1e8)}</span></span><span>C <span class="${cl}">${fKRW2(x.close*1e8)}</span></span><span>${ch>=0?'+':''}${ch}%</span>`;});}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AIEngine={
  scoreForAgent(patent,agent){
    if(!agent.interests.some(i=>patent.field.includes(i)||i.includes(patent.field)))return 0;
    const avg=(patent.techScore+patent.marketScore+patent.legalScore)/3;
    if(avg<agent.minScore)return 0;
    let score=avg;
    if(patent.isSEP)score+=15;if(patent.remainingYears>15)score+=5;if(patent.citedBy>20)score+=5;
    const infr=infringementData[patent.id]||[];const highRisk=infr.filter(x=>x.risk==='high').length;
    if(highRisk>=2)score+=12;else if(highRisk>=1)score+=7;else if(infr.length>0)score+=3;
    const licR=licenseRefData[patent.id];if(licR&&licR.recentDeals.length>0)score+=5;if(licR&&licR.frandRate)score+=5;
    if(agent.strategy==='aggressive')score+=10;if(agent.strategy==='conservative')score-=5;
    const budget_ok=(agent.role==='seller'||agent.role==='monitor')?true:patent.value<=agent.maxPerDeal;
    return budget_ok?Math.min(100,Math.round(score)):0;
  },
  getRecommendations(role){
    const recs=[];
    if(role==='buyer'){patents.filter(p=>p.forSale).forEach(p=>{const bestAgent=aiAgents.filter(a=>a.role==='buyer'&&a.active).map(a=>({a,s:this.scoreForAgent(p,a)})).sort((a,b)=>b.s-a.s)[0];if(bestAgent&&bestAgent.s>60)recs.push({type:'buy',patent:p,agent:bestAgent.a,score:bestAgent.s,reason:p.isSEP?'High-value SEP with strong market position':'Strong tech score ('+p.techScore+') in growing market',action:'Initiate Trade'});});}
    else if(role==='seller'){patents.forEach(p=>{const buyers=aiAgents.filter(a=>(a.role==='buyer'||a.role==='broker')&&a.active);const demand=buyers.reduce((s,a)=>s+this.scoreForAgent(p,a),0)/Math.max(1,buyers.length);if(demand>50)recs.push({type:'sell',patent:p,score:Math.round(demand),reason:'High demand from '+buyers.filter(a=>this.scoreForAgent(p,a)>50).length+' AI agents',action:'List for Sale'});});}
    else if(role==='licensor'){patents.filter(p=>p.forLicense).forEach(p=>{const licensees=aiAgents.filter(a=>a.role==='licensee'&&a.active);const interest=licensees.reduce((s,a)=>s+this.scoreForAgent(p,a),0)/Math.max(1,licensees.length);if(interest>40)recs.push({type:'license_out',patent:p,score:Math.round(interest),reason:p.isSEP?'SEP licensing opportunity ‚Äî FRAND terms applicable':'Multiple licensee agents interested',action:'Offer License'});});}
    else if(role==='licensee'){patents.filter(p=>p.forLicense).forEach(p=>{const bestAgent=aiAgents.filter(a=>a.role==='licensee'&&a.active).map(a=>({a,s:this.scoreForAgent(p,a)})).sort((a,b)=>b.s-a.s)[0];if(bestAgent&&bestAgent.s>50)recs.push({type:'license_in',patent:p,agent:bestAgent.a,score:bestAgent.s,reason:'Matches portfolio strategy: '+bestAgent.a.interests.join(', '),action:'Request License'});});}
    else{const topPatents=[...patents].sort((a,b)=>b.value-a.value).slice(0,5);topPatents.forEach(p=>recs.push({type:'watch',patent:p,score:Math.round((p.techScore+p.marketScore+p.legalScore)/3),reason:'Top value patent ‚Äî monitor for price movements',action:'View Chart'}));}
    return recs.sort((a,b)=>b.score-a.score).slice(0,6);
  },
  findMatches(){const matches=[];const buyers=aiAgents.filter(a=>(a.role==='buyer'||a.role==='broker')&&a.active);const licensees=aiAgents.filter(a=>(a.role==='licensee'||a.role==='broker')&&a.active);patents.forEach(p=>{if(p.forSale){buyers.forEach(b=>{const bs=this.scoreForAgent(p,b);if(bs>65)matches.push({type:'trade',patent:p,buyerAgent:b,score:bs})});}if(p.forLicense){licensees.forEach(l=>{const ls=this.scoreForAgent(p,l);if(ls>55)matches.push({type:'license',patent:p,licenseeAgent:l,score:ls})});}});return matches.sort((a,b)=>b.score-a.score);},
  negotiate(match){const steps=[];const p=match.patent;const agent=match.buyerAgent||match.licenseeAgent;const isAggressive=agent.strategy==='aggressive';const isConservative=agent.strategy==='conservative';steps.push({title:'AI Valuation Analysis',desc:`${agent.name} analyzed ${p.title}. Composite score: ${this.scoreForAgent(p,agent)}/100.`,status:'done'});const discount=isAggressive?0.95:isConservative?0.75:0.85;const offer=Math.round(p.value*discount);steps.push({title:'Initial Offer Submitted',desc:`${agent.name} offered ${fUSD(offer)} (${Math.round(discount*100)}% of ${fUSD(p.value)}).`,status:'done'});const counter=Math.round(p.value*(isConservative?0.95:0.92));steps.push({title:'Counter-Offer Received',desc:`Patent owner countered at ${fUSD(counter)}.`,status:'done'});const final=Math.round((offer+counter)/2);steps.push({title:'Final Negotiation',desc:`${agent.name} proposed split at ${fUSD(final)}.`,status:isAggressive?'done':'active'});if(isAggressive||agent.strategy==='balanced'){steps.push({title:'Deal Closed',desc:`${match.type==='trade'?'Trade':'License'} agreement at ${fUSD(final)}.`,status:isAggressive?'done':'active'});}else{steps.push({title:'Under Review',desc:'Conservative agent reviewing terms.',status:'pending'});}return{steps,finalPrice:final};},
  runAutoCycle(){const matches=this.findMatches().slice(0,3);let dealsCompleted=0;matches.forEach(m=>{const agent=m.buyerAgent||m.licenseeAgent;if(!agent||!agent.active)return;const nego=this.negotiate(m);const allDone=nego.steps.every(s=>s.status==='done');if(allDone){transactions.push({id:transactions.length+1,patentId:m.patent.id,type:m.type==='trade'?'Trade':'License',buyer:agent.name,amount:nego.finalPrice,date:new Date().toISOString().slice(0,10),status:'AI Auto',agentId:agent.id,isAI:true});agent.deals++;agent.spent+=nego.finalPrice;dealsCompleted++;addFeed(agent.avatar,agent.bg,`${agent.name} ‚Äî ${m.type==='trade'?'Trade':'License'}`,`Completed: ${m.patent.title} at ${fUSD(nego.finalPrice)}`,agent.id);}else{addFeed(agent.avatar,agent.bg,`${agent.name} ‚Äî Negotiating`,`${m.type} in progress: ${m.patent.title}`,agent.id);}});if(dealsCompleted>0)notify(`AI Agents completed ${dealsCompleted} deal(s)!`,'info');return dealsCompleted;}
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV & RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const tabDefs=[
  {id:'dashboard',i18nKey:'dashboard',icon:'<rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/>',roles:['buyer','seller','licensor','licensee','monitor','guest']},
  {id:'patents',i18nKey:'patents',icon:'<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>',roles:['buyer','seller','licensor','licensee','monitor','guest']},
  {id:'agents',i18nKey:'aiAgents',icon:'<circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>',roles:['buyer','seller','licensor','licensee','monitor']},
  {id:'chart',i18nKey:'valueChart',icon:'<path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>',roles:['buyer','seller','licensor','licensee','monitor','guest']},
  {id:'value',i18nKey:'analysis',icon:'<path d="M18 20V10M12 20V4M6 20v-6"/>',roles:['buyer','seller','licensor','licensee','monitor','guest']},
  {id:'transactions',i18nKey:'transactions',icon:'<path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 014-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 01-4 4H3"/>',roles:['buyer','seller','licensor','licensee','monitor']}
];
let activeTab='dashboard';
function renderNav(){
  const tabs=tabDefs.filter(t=>t.roles.includes(currentRole));
  document.getElementById('navTabs').innerHTML=tabs.map(t=>`<button class="tab-btn${activeTab===t.id?' active':''}" onclick="switchTab('${t.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${t.icon}</svg>${T(t.i18nKey)}</button>`).join('');
}
function switchTab(tab){activeTab=tab;document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));const el=document.getElementById('tab-'+tab);if(el)el.classList.add('active');renderNav();({dashboard:renderDashboard,patents:renderPatents,agents:renderAgents,chart:renderChartTab,value:renderValue,transactions:renderTransactions})[tab]?.();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard(){
  const tv=patents.reduce((s,p)=>s+p.value,0);updateTV();
  const sepC=patents.filter(p=>p.isSEP).length;
  const aiDeals=transactions.filter(t=>t.isAI).length;
  const activeAg=aiAgents.filter(a=>a.active).length;
  const recs=isGuest()?[]:AIEngine.getRecommendations(currentRole);
  const R=ROLES[currentRole.toUpperCase()]||ROLES.GUEST;

  let h='';
  if(isGuest())h+=`<div class="guest-notice">üåê ${T('guestNotice')}</div>`;

  h+=`<div style="margin-bottom:16px;display:flex;align-items:center;gap:10px">
    <span style="font-size:28px">${R.icon}</span>
    <div><div style="font-size:18px;font-weight:800">${T(R.label)} ${T('dashboard')}</div>
    <div style="font-size:12px;color:var(--text-muted)">${T('headerSubDesc')}</div></div>
  </div>
  <div class="stat-grid">
    <div class="stat-card sc-blue"><div class="label">${T('totalPatents')} <span class="emoji">üìã</span></div><div class="val">${patents.length}<span class="unit">ea</span></div></div>
    <div class="stat-card sc-green"><div class="label">${T('portfolioValue')} <span class="emoji">üíé</span></div><div class="val">${fUSD(tv)}</div><div class="kr-sub">${fKRW(tv)}</div></div>
    <div class="stat-card sc-amber"><div class="label">${T('sepPatents')} <span class="emoji">‚òÖ</span></div><div class="val">${sepC}</div></div>
    <div class="stat-card sc-purple"><div class="label">${T('activeAgents')} <span class="emoji">ü§ñ</span></div><div class="val">${activeAg}<span class="unit">${T('active')}</span></div></div>
    <div class="stat-card sc-cyan"><div class="label">${T('aiDeals')} <span class="emoji">‚ö°</span></div><div class="val">${aiDeals}</div></div>
  </div>`;

  if(recs.length){
    h+=`<div class="card"><h3>ü§ñ ${T('aiRecommendations')}</h3>`;
    recs.forEach(r=>{
      h+=`<div class="rec-card"><h4><span class="rec-score">${r.score}/100</span> ${r.patent.title} ${r.patent.isSEP?'<span class="badge-sep">SEP</span>':''}</h4>
      <p>${r.reason} ¬∑ Value: <strong>${fUSD(r.patent.value)}</strong>${r.agent?' ¬∑ Agent: '+r.agent.name:''}</p>
      <div class="rec-action">
        <button class="btn btn-primary" onclick="${r.type==='buy'?"openTrade('"+r.patent.id+"')":r.type==='watch'?"openCandleModal('"+r.patent.id+"')":"openLicense('"+r.patent.id+"')"}">${r.action}</button>
        <button class="btn btn-outline" onclick="openDetail('${r.patent.id}')">${T('details')}</button>
        ${r.agent?`<button class="btn btn-purple" onclick="runAgentNego('${r.patent.id}','${r.agent.id}')">ü§ñ AI Auto-Deal</button>`:''}
      </div></div>`;
    });
    h+=`</div>`;
  }

  h+=`<div class="chart-row"><div class="card"><h3>üìä ${T('marketOverview')}</h3><div class="chart-container"><canvas id="cDashBar"></canvas></div></div>
  <div class="card"><h3>‚ö° ${T('agentActivity')}</h3>`;
  if(!activityFeed.length)h+=`<div style="text-align:center;color:var(--text-muted);padding:30px;font-size:12px">${T('noActivity')}</div>`;
  else activityFeed.slice(0,8).forEach(f=>{h+=`<div class="feed-item"><div class="feed-icon" style="background:${f.bg}">${f.icon}</div><div class="feed-content"><div class="feed-title">${f.title}</div><div class="feed-desc">${f.desc}</div></div><div class="feed-time">${timeAgo(f.time)}</div></div>`;});
  h+=`</div></div>`;

  h+=`<div class="card"><h3>${T('recentTransactions')}</h3>`;
  if(!transactions.length)h+=`<p style="text-align:center;color:var(--text-muted);padding:20px;font-size:12px">${T('noTransactions')}</p>`;
  else{h+=`<table><thead><tr><th>Patent</th><th>Type</th><th>Counterparty</th><th>Amount</th><th>Date</th><th>Status</th></tr></thead><tbody>`;
  transactions.slice(-6).reverse().forEach(tx=>{h+=`<tr><td class="mono">${tx.patentId}</td><td>${typeBadge(tx.type)}</td><td>${tx.buyer}${tx.isAI?' ü§ñ':''}</td><td style="font-weight:700;color:var(--text-primary)">${fUSD(tx.amount)}</td><td>${tx.date}</td><td>${txBadge(tx.status)}</td></tr>`;});
  h+=`</tbody></table>`;}
  h+=`</div>`;

  document.getElementById('tab-dashboard').innerHTML=h;
  const fm={};patents.forEach(p=>{const f=p.field;fm[f]=(fm[f]||0)+p.value;});
  const fl=Object.keys(fm),fv=fl.map(f=>fm[f]),colors=['#3b82f6','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#14b8a6'];
  destroyChart('dBar');
  Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='#1e293b';
  chartInstances.dBar=new Chart(document.getElementById('cDashBar'),{type:'bar',data:{labels:fl,datasets:[{label:'Value',data:fv,backgroundColor:colors,borderRadius:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{ticks:{callback:v=>fUSD(v)},grid:{color:'#1e293b'}},x:{grid:{display:false}}}}});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PATENTS LIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let sepFilterOn=false;
function renderPatents(){
  const fields=['All',...new Set(patents.map(p=>p.field))];
  const sts=['All','Granted','Published','Under Review'];
  let h=``;
  if(isGuest())h+=`<div class="guest-notice">üåê ${T('guestNotice')}</div>`;
  h+=`<div class="card" style="margin-bottom:14px;padding:14px 18px">
    <div class="filter-bar">
      <input type="text" id="searchInput" placeholder="${T('searchPatents')}" oninput="filterPatents()">
      <select id="fieldFilter" onchange="filterPatents()">${fields.map(f=>`<option>${f}</option>`).join('')}</select>
      <select id="statusFilter" onchange="filterPatents()">${sts.map(s=>`<option>${s}</option>`).join('')}</select>
      <div class="sep-filter${sepFilterOn?' active':''}" onclick="sepFilterOn=!sepFilterOn;renderPatents()">‚òÖ SEP</div>
      <span style="font-size:11px;color:var(--text-muted)" id="filterCount">${patents.length}</span>
      ${!isGuest()&&currentRole!=='monitor'?`<button class="btn btn-orange" onclick="openUploadModal()">+ Register</button>`:''}
    </div>
  </div><div id="patentList"></div>`;
  document.getElementById('tab-patents').innerHTML=h;filterPatents();
}
function filterPatents(){
  const q=(document.getElementById('searchInput')?.value||'').toLowerCase();
  const ff=document.getElementById('fieldFilter')?.value||'All';
  const sf=document.getElementById('statusFilter')?.value||'All';
  const filtered=patents.filter(p=>{
    const mq=!q||p.title.toLowerCase().includes(q)||p.titleKr.includes(q)||p.owner.toLowerCase().includes(q)||p.id.toLowerCase().includes(q)||p.field.toLowerCase().includes(q);
    const mf=ff==='All'||p.field===ff;const ms=sf==='All'||p.status===sf;const msep=!sepFilterOn||p.isSEP;
    return mq&&mf&&ms&&msep;
  });
  document.getElementById('filterCount').textContent=filtered.length+' patents';
  const isBuyer=currentRole==='buyer';const isSeller=currentRole==='seller';const isLicensor=currentRole==='licensor';const isLicensee=currentRole==='licensee';const isMon=currentRole==='monitor';const isG=isGuest();
  document.getElementById('patentList').innerHTML=filtered.map(p=>{
    let btns=`<button class="btn btn-outline" onclick="openDetail('${p.id}')">${T('details')}</button><button class="btn btn-outline" onclick="openCandleModal('${p.id}')" style="color:var(--amber)">üìà</button>`;
    if(!isG){
      if(isBuyer&&p.forSale)btns+=`<button class="btn btn-primary" onclick="openTrade('${p.id}')">${T('buy')}</button>`;
      if(isSeller)btns+=`<button class="btn btn-orange" onclick="openTrade('${p.id}')">${T('sell')}</button>`;
      if(isLicensor&&p.forLicense)btns+=`<button class="btn btn-emerald" onclick="openLicense('${p.id}')">${T('offerLicense')}</button>`;
      if(isLicensee&&p.forLicense)btns+=`<button class="btn btn-emerald" onclick="openLicense('${p.id}')">${T('requestLicense')}</button>`;
      if(!isMon)btns+=`<button class="btn btn-purple" onclick="autoAgentDeal('${p.id}')">ü§ñ AI</button>`;
    }
    return`<div class="patent-item${p.isSEP?' is-sep':''}"><div class="patent-header">
      <div class="patent-info">
        <div class="patent-meta"><span class="mono">${p.id}</span>${statusBadge(p.status)}${sepBadge(p)}${badge(p.field,'gray')}${p.forSale?badge(T('forSale'),'green'):''}${p.forLicense?badge(T('licensable'),'blue'):''}</div>
        <div class="patent-title" onclick="openDetail('${p.id}')">${p.title}</div>
        <div class="patent-title-kr">${p.titleKr}</div>
        <div class="patent-sub">${T('owner')}: <strong>${p.owner}</strong> (${p.ownerKr}) ¬∑ Claims: ${p.claims} ¬∑ Cited: ${p.citedBy}</div>
        ${p.isSEP?`<div style="margin:4px 0">${sepInd(p)}</div>`:''}
        <div class="patent-desc">${p.description}</div>
      </div>
      <div class="patent-actions">
        <div class="patent-value">${fUSD(p.value)}</div>
        <div style="font-size:10px;color:var(--text-muted)">${fKRW(p.value)}</div>
        <div class="btn-group">${btns}</div>
      </div>
    </div></div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI AGENTS TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAgents(){
  const matches=AIEngine.findMatches();
  let h=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px">
    <div><div style="font-size:18px;font-weight:800">ü§ñ ${T('agentHub')}</div>
    <div style="font-size:11px;color:var(--text-muted)">${T('headerSubDesc')}</div></div>
    <div style="display:flex;gap:6px">
      <button class="btn btn-primary" onclick="runAICycle()">‚ö° ${T('runAICycle')}</button>
      <button class="btn btn-purple" onclick="runAllMatches()">üîÑ ${T('autoMatchAll')}</button>
    </div>
  </div>`;
  h+=`<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:14px;margin-bottom:20px">`;
  aiAgents.forEach(a=>{
    h+=`<div class="agent-card ${a.active?'agent-active':'agent-paused'}">
      <div class="agent-header">
        <div class="agent-avatar" style="background:${a.bg}">${a.avatar}</div>
        <div class="agent-info">
          <div class="agent-name">${a.name} ${a.active?'<span style="color:var(--emerald);font-size:10px">‚óè Active</span>':'<span style="color:var(--text-muted);font-size:10px">‚óè Paused</span>'}</div>
          <div class="agent-type">${roleBadge(a.role)} ${badge(a.strategy,a.strategy==='aggressive'?'red':a.strategy==='conservative'?'blue':'green')} ¬∑ ${a.interests.join(', ')}</div>
          <div style="font-size:10px;color:var(--text-muted);margin-top:4px">${a.desc}</div>
        </div>
      </div>
      <div class="agent-stats">
        ${a.role!=='monitor'&&a.role!=='seller'?`<div class="agent-stat"><div class="as-val">${fUSD(a.budget-a.spent)}</div><div class="as-label">Budget Left</div></div>`:''}
        <div class="agent-stat"><div class="as-val">${a.deals}</div><div class="as-label">Deals</div></div>
        ${a.role!=='monitor'&&a.role!=='seller'?`<div class="agent-stat"><div class="as-val">${fUSD(a.spent)}</div><div class="as-label">Spent</div></div>`:''}
        <div class="agent-stat"><div class="as-val">${a.minScore||'N/A'}</div><div class="as-label">Min Score</div></div>
      </div>
      <div class="agent-actions-bar">
        <button class="btn ${a.active?'btn-gray':'btn-emerald'}" onclick="toggleAgent('${a.id}')">${a.active?'Pause':'Activate'}</button>
        <button class="btn btn-outline" onclick="viewAgentDetail('${a.id}')">Detail</button>
        <button class="btn btn-purple" onclick="runSingleAgent('${a.id}')">‚ö° Run</button>
      </div>
    </div>`;
  });
  h+=`</div>`;
  h+=`<div class="card"><h3>üîÑ ${T('matchResults')}</h3>`;
  if(!matches.length)h+=`<p style="text-align:center;color:var(--text-muted);padding:20px;font-size:12px">No matches found.</p>`;
  else{h+=`<table><thead><tr><th>Type</th><th>Patent</th><th>Agent</th><th>Score</th><th>Est. Price</th><th>Action</th></tr></thead><tbody>`;
  matches.slice(0,10).forEach(m=>{const agent=m.buyerAgent||m.licenseeAgent;const est=Math.round(m.patent.value*(agent.strategy==='aggressive'?0.95:agent.strategy==='conservative'?0.85:0.9));
    h+=`<tr><td>${typeBadge(m.type==='trade'?'Trade':'License')}</td><td style="font-weight:600;font-size:11px;color:var(--text-primary)">${m.patent.title.slice(0,30)}${m.patent.isSEP?' ‚òÖ':''}</td><td><span style="font-size:14px">${agent.avatar}</span> ${agent.name}</td><td><span class="rec-score">${m.score}</span></td><td style="font-weight:700;color:var(--text-primary)">${fUSD(est)}</td><td><button class="btn btn-purple" onclick="runAgentNego('${m.patent.id}','${agent.id}')">ü§ñ Negotiate</button></td></tr>`;
  });h+=`</tbody></table>`;}
  h+=`</div>`;
  h+=`<div class="card"><h3>üìã ${T('agentLog')}</h3>`;
  if(!activityFeed.length)h+=`<p style="text-align:center;color:var(--text-muted);padding:20px;font-size:12px">No activity yet.</p>`;
  else activityFeed.slice(0,15).forEach(f=>{h+=`<div class="feed-item"><div class="feed-icon" style="background:${f.bg}">${f.icon}</div><div class="feed-content"><div class="feed-title">${f.title}</div><div class="feed-desc">${f.desc}</div></div><div class="feed-time">${timeAgo(f.time)}</div></div>`;});
  h+=`</div>`;
  document.getElementById('tab-agents').innerHTML=h;
}

function toggleAgent(id){const a=aiAgents.find(x=>x.id===id);if(a){a.active=!a.active;notify(`${a.name} ${a.active?'activated':'paused'}.`);renderAgents();}}
function runAICycle(){const d=AIEngine.runAutoCycle();renderAgents();if(!d)notify('AI Cycle complete ‚Äî no deals matched.','info');}
function runAllMatches(){const matches=AIEngine.findMatches();let done=0;matches.slice(0,5).forEach(m=>{const agent=m.buyerAgent||m.licenseeAgent;if(!agent||!agent.active)return;const nego=AIEngine.negotiate(m);if(nego.steps.every(s=>s.status==='done')){transactions.push({id:transactions.length+1,patentId:m.patent.id,type:m.type==='trade'?'Trade':'License',buyer:agent.name,amount:nego.finalPrice,date:new Date().toISOString().slice(0,10),status:'AI Auto',agentId:agent.id,isAI:true});agent.deals++;agent.spent+=nego.finalPrice;done++;addFeed(agent.avatar,agent.bg,`${agent.name} ‚Äî Auto Deal`,`${m.type} on ${m.patent.title} at ${fUSD(nego.finalPrice)}`,agent.id);}});notify(`Auto-matched ${done} deal(s)!`,'info');renderAgents();}
function runSingleAgent(id){const a=aiAgents.find(x=>x.id===id);if(!a||!a.active){notify('Agent is not active.','error');return;}const matches=AIEngine.findMatches().filter(m=>(m.buyerAgent?.id||m.licenseeAgent?.id)===id);let done=0;matches.slice(0,2).forEach(m=>{const nego=AIEngine.negotiate(m);if(nego.steps.every(s=>s.status==='done')){transactions.push({id:transactions.length+1,patentId:m.patent.id,type:m.type==='trade'?'Trade':'License',buyer:a.name,amount:nego.finalPrice,date:new Date().toISOString().slice(0,10),status:'AI Auto',agentId:a.id,isAI:true});a.deals++;a.spent+=nego.finalPrice;done++;addFeed(a.avatar,a.bg,`${a.name} ‚Äî Deal`,`${m.type} on ${m.patent.title}`,a.id);}});notify(`${a.name}: ${done} deal(s).`,'info');renderAgents();}
function autoAgentDeal(pid){if(isGuest()){notify('Login required for trading.','error');return;}const p=patents.find(x=>x.id===pid);if(!p)return;const role=currentRole==='buyer'||currentRole==='licensee'?currentRole:'buyer';const agent=aiAgents.filter(a=>a.active&&(a.role===role||a.role==='broker')).sort((a,b)=>AIEngine.scoreForAgent(p,b)-AIEngine.scoreForAgent(p,a))[0];if(!agent){notify('No suitable active AI agent found.','error');return;}runAgentNego(pid,agent.id);}

function runAgentNego(pid,aid){const p=patents.find(x=>x.id===pid);const a=aiAgents.find(x=>x.id===aid);if(!p||!a)return;const m={type:a.role==='licensee'?'license':'trade',patent:p,buyerAgent:a.role!=='licensee'?a:null,licenseeAgent:a.role==='licensee'?a:null,score:AIEngine.scoreForAgent(p,a)};const nego=AIEngine.negotiate(m);
  let h=`<div class="info-box info-box-blue"><div style="display:flex;gap:10px;align-items:center"><span style="font-size:28px">${a.avatar}</span><div><div class="info-title">${a.name} ‚Üí ${p.title}</div><div class="info-sub">${a.strategy} strategy ¬∑ Score: ${m.score}/100</div></div></div></div>`;
  h+=`<div class="nego-timeline">`;
  nego.steps.forEach(s=>{h+=`<div class="nego-step ${s.status}"><div class="ns-title">${s.status==='done'?'‚úÖ':s.status==='active'?'üîÑ':'‚è≥'} ${s.title}</div><div class="ns-desc">${s.desc}</div></div>`;});
  h+=`</div>`;
  const allDone=nego.steps.every(s=>s.status==='done');
  h+=`<div style="display:flex;gap:10px;margin-top:16px">`;
  if(allDone)h+=`<button class="btn btn-emerald btn-lg" onclick="confirmAgentDeal('${p.id}','${a.id}',${nego.finalPrice},'${m.type}')">‚úÖ Confirm Deal</button>`;
  else h+=`<button class="btn btn-primary btn-lg" onclick="forceAgentDeal('${p.id}','${a.id}',${nego.finalPrice},'${m.type}')">‚ö° Force Execute</button>`;
  h+=`<button class="btn btn-gray btn-lg" onclick="closeModal('negoModal')">Close</button></div>`;
  document.getElementById('negoModalBody').innerHTML=h;openModal('negoModal');
}
function confirmAgentDeal(pid,aid,price,type){const a=aiAgents.find(x=>x.id===aid);transactions.push({id:transactions.length+1,patentId:pid,type:type==='trade'?'Trade':'License',buyer:a.name,amount:price,date:new Date().toISOString().slice(0,10),status:'AI Auto',agentId:aid,isAI:true});a.deals++;a.spent+=price;addFeed(a.avatar,a.bg,`${a.name} ‚Äî Deal Confirmed`,`${type} on ${pid} at ${fUSD(price)}`,aid);closeModal('negoModal');notify(`Deal confirmed! ${fUSD(price)}`);}
function forceAgentDeal(pid,aid,price,type){confirmAgentDeal(pid,aid,price,type);}

function viewAgentDetail(id){const a=aiAgents.find(x=>x.id===id);if(!a)return;
  const agentTx=transactions.filter(t=>t.agentId===id);
  const relPatents=patents.map(p=>({p,s:AIEngine.scoreForAgent(p,a)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s);
  let h=`<div style="display:flex;gap:14px;align-items:center;margin-bottom:16px"><div class="agent-avatar" style="background:${a.bg};width:60px;height:60px;font-size:32px">${a.avatar}</div><div><div style="font-size:18px;font-weight:800">${a.name}</div><div style="font-size:12px;color:var(--text-muted)">${a.desc}</div><div style="margin-top:4px">${roleBadge(a.role)} ${badge(a.strategy,a.strategy==='aggressive'?'red':'blue')}</div></div></div>`;
  h+=`<div class="detail-grid"><div class="detail-item"><div class="d-label">Role</div><div class="d-value">${a.role}</div></div><div class="detail-item"><div class="d-label">Strategy</div><div class="d-value">${a.strategy}</div></div><div class="detail-item"><div class="d-label">Budget</div><div class="d-value">${fUSD(a.budget)}</div></div><div class="detail-item"><div class="d-label">Spent</div><div class="d-value">${fUSD(a.spent)}</div></div><div class="detail-item"><div class="d-label">Deals</div><div class="d-value">${a.deals}</div></div><div class="detail-item"><div class="d-label">Interests</div><div class="d-value" style="font-size:11px">${a.interests.join(', ')}</div></div></div>`;
  if(relPatents.length){h+=`<div style="font-weight:700;font-size:13px;margin:12px 0 8px">Top Matching Patents</div><table><thead><tr><th>Patent</th><th>Score</th><th>Value</th><th>Action</th></tr></thead><tbody>`;relPatents.slice(0,5).forEach(x=>{h+=`<tr><td style="font-weight:600;font-size:11px;color:var(--text-primary)">${x.p.title.slice(0,30)}${x.p.isSEP?' ‚òÖ':''}</td><td><span class="rec-score">${x.s}</span></td><td style="color:var(--text-primary)">${fUSD(x.p.value)}</td><td><button class="btn btn-purple" onclick="closeModal('agentModal');runAgentNego('${x.p.id}','${a.id}')">ü§ñ Deal</button></td></tr>`;});h+=`</tbody></table>`;}
  if(agentTx.length){h+=`<div style="font-weight:700;font-size:13px;margin:12px 0 8px">Transaction History</div><table><thead><tr><th>Patent</th><th>Type</th><th>Amount</th><th>Date</th></tr></thead><tbody>`;agentTx.forEach(t=>{h+=`<tr><td class="mono">${t.patentId}</td><td>${typeBadge(t.type)}</td><td style="font-weight:700;color:var(--text-primary)">${fUSD(t.amount)}</td><td>${t.date}</td></tr>`;});h+=`</tbody></table>`;}
  document.getElementById('agentModalTitle').textContent=a.name+' ‚Äî Detail';document.getElementById('agentModalBody').innerHTML=h;openModal('agentModal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let chartTabP=0,chartTabPer='daily';
function renderChartTab(){
  const p=patents[chartTabP];
  let h=`<div class="card" style="padding:14px 18px;margin-bottom:10px">
    <div style="font-size:12px;font-weight:700;margin-bottom:8px;color:var(--text-primary)">${T('selectPatent')}</div>
    <div class="chart-patent-select">${patents.map((pt,i)=>`<div class="chart-patent-chip${i===chartTabP?' active':''}" onclick="chartTabP=${i};renderChartTab()">${pt.isSEP?'‚òÖ ':''}${pt.title.length>16?pt.title.slice(0,16)+'‚Ä¶':pt.title}</div>`).join('')}</div>
  </div>
  <div class="candle-wrap">
    <div class="candle-toolbar"><span class="tb-label">${p.title}</span>${p.isSEP?'<span class="badge-sep" style="margin-left:6px">SEP</span>':''}<div class="tb-sep"></div>
    <button class="tb-btn${chartTabPer==='daily'?' active':''}" onclick="chartTabPer='daily';renderChartTab()">Daily</button>
    <button class="tb-btn${chartTabPer==='weekly'?' active':''}" onclick="chartTabPer='weekly';renderChartTab()">Weekly</button>
    <button class="tb-btn${chartTabPer==='monthly'?' active':''}" onclick="chartTabPer='monthly';renderChartTab()">Monthly</button>
    <div class="tb-sep"></div><span class="tb-label">Current</span><span style="font-size:14px;font-weight:800;color:var(--green-up)" id="chartCurP"></span></div>
    <div class="candle-info" id="chartTabInfo"><span style="color:var(--text-muted)">${T('hoverDetails')}</span></div>
    <div class="candle-canvas-wrap"><canvas id="chartTabCv"></canvas></div>
    <div class="candle-legend"><span><span class="leg-dot" style="background:#f59e0b"></span>MA5</span><span><span class="leg-dot" style="background:#3b82f6"></span>MA20</span><span><span class="leg-dot" style="background:#ec4899"></span>MA60</span><span style="margin-left:auto"><span style="color:var(--green-up)">‚ñ†</span> Bull</span><span><span style="color:var(--red-down)">‚ñ†</span> Bear</span></div>
  </div>`;
  document.getElementById('tab-chart').innerHTML=h;
  const daily=getOHLC(p),ohlc=aggOHLC(daily,chartTabPer),last=ohlc[ohlc.length-1];
  document.getElementById('chartCurP').textContent=fUSD(last.close*1e8);
  setTimeout(()=>{drawCandle('chartTabCv',ohlc,{height:440});setupHover('chartTabCv','chartTabInfo');},50);
}
let candleMP='daily';
function openCandleModal(pid){currentPatent=patents.find(p=>p.id===pid);if(!currentPatent)return;candleMP='daily';renderCM();openModal('candleModal');}
function setCMP(p){candleMP=p;renderCM();}
function renderCM(){const p=currentPatent;const daily=getOHLC(p),ohlc=aggOHLC(daily,candleMP),last=ohlc[ohlc.length-1];
  document.getElementById('candleModalTitle').textContent=p.title+' ‚Äî Value Chart';
  document.getElementById('candleModalBody').innerHTML=`<div class="candle-wrap" style="border-radius:0;border:none"><div class="candle-toolbar"><span class="tb-label">${p.owner}</span>${p.isSEP?'<span class="badge-sep" style="margin-left:6px">SEP</span>':''}<div class="tb-sep"></div><button class="tb-btn${candleMP==='daily'?' active':''}" onclick="setCMP('daily')">Daily</button><button class="tb-btn${candleMP==='weekly'?' active':''}" onclick="setCMP('weekly')">Weekly</button><button class="tb-btn${candleMP==='monthly'?' active':''}" onclick="setCMP('monthly')">Monthly</button><div class="tb-sep"></div><span style="font-size:14px;font-weight:800;color:var(--green-up)">${fUSD(last.close*1e8)}</span></div><div class="candle-info" id="cmI"><span style="color:var(--text-muted)">Hover for details</span></div><div class="candle-canvas-wrap"><canvas id="cmCv"></canvas></div><div class="candle-legend"><span><span class="leg-dot" style="background:#f59e0b"></span>MA5</span><span><span class="leg-dot" style="background:#3b82f6"></span>MA20</span><span><span class="leg-dot" style="background:#ec4899"></span>MA60</span></div></div>`;
  setTimeout(()=>{drawCandle('cmCv',ohlc,{height:420});setupHover('cmCv','cmI');},80);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VALUE ANALYSIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderValue(){
  let h=`<div class="chart-row">
    <div class="card"><h3>${T('techStrength')} / ${T('marketPotential')} / ${T('legalStability')}</h3><div class="chart-container"><canvas id="cRadar"></canvas></div></div>
    <div class="card"><h3>${T('analysis')}</h3><div class="chart-container"><canvas id="cDist"></canvas></div></div>
  </div>
  <div class="card"><h3>${T('analysis')} ‚Äî ${T('patents')}</h3>
  <table><thead><tr><th>Patent</th><th>Type</th><th>Tech</th><th>Market</th><th>Legal</th><th>Avg</th><th>Value</th></tr></thead><tbody>
  ${patents.map(p=>{const a=Math.round((p.techScore+p.marketScore+p.legalScore)/3);return`<tr><td style="font-weight:600;font-size:11px;color:var(--text-primary)">${p.title.slice(0,25)}</td><td>${p.isSEP?'<span class="badge-sep">SEP</span>':badge('Gen','gray')}</td><td><span class="score-bar-bg"><span class="score-bar" style="width:${p.techScore}%;background:#3b82f6"></span></span>${p.techScore}</td><td><span class="score-bar-bg"><span class="score-bar" style="width:${p.marketScore}%;background:var(--emerald)"></span></span>${p.marketScore}</td><td><span class="score-bar-bg"><span class="score-bar" style="width:${p.legalScore}%;background:var(--amber)"></span></span>${p.legalScore}</td><td style="font-weight:700;color:var(--accent-light)">${a}</td><td style="font-weight:600;color:var(--text-primary)">${fUSD(p.value)}</td></tr>`;}).join('')}
  </tbody></table></div>`;
  document.getElementById('tab-value').innerHTML=h;
  const colors=['#3b82f6','#06b6d4','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#14b8a6','#3b82f6','#6366f1'];
  Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='#1e293b';
  destroyChart('radar');chartInstances.radar=new Chart(document.getElementById('cRadar'),{type:'radar',data:{labels:patents.map(p=>(p.isSEP?'‚òÖ ':'')+p.title.slice(0,10)),datasets:[{label:'Tech',data:patents.map(p=>p.techScore),borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,.08)',borderWidth:2},{label:'Market',data:patents.map(p=>p.marketScore),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,.08)',borderWidth:2},{label:'Legal',data:patents.map(p=>p.legalScore),borderColor:'#f59e0b',backgroundColor:'rgba(245,158,11,.08)',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{min:60,max:100,grid:{color:'#1e293b'},angleLines:{color:'#1e293b'},pointLabels:{color:'#94a3b8',font:{size:8}},ticks:{backdropColor:'transparent',color:'#64748b'}}},plugins:{legend:{position:'bottom',labels:{color:'#94a3b8',font:{size:10}}}}}});
  const dist=[{r:'<$5M',c:patents.filter(p=>p.value<5e8).length},{r:'$5-10M',c:patents.filter(p=>p.value>=5e8&&p.value<1e9).length},{r:'$10-15M',c:patents.filter(p=>p.value>=1e9&&p.value<1.5e9).length},{r:'$15-20M',c:patents.filter(p=>p.value>=1.5e9&&p.value<2e9).length},{r:'>$20M',c:patents.filter(p=>p.value>=2e9).length}];
  destroyChart('dist');chartInstances.dist=new Chart(document.getElementById('cDist'),{type:'bar',data:{labels:dist.map(d=>d.r),datasets:[{label:'Patents',data:dist.map(d=>d.c),backgroundColor:colors.slice(0,5),borderRadius:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{grid:{color:'#1e293b'}},x:{grid:{display:false}}}}});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTransactions(){
  let h=`<div class="card"><h3>${T('transactions')}</h3>`;
  if(!transactions.length)h+=`<p style="text-align:center;color:var(--text-muted);padding:30px;font-size:12px">${T('noTransactions')}</p>`;
  else{h+=`<table><thead><tr><th>#</th><th>Patent</th><th>Type</th><th>Counterparty</th><th>Amount</th><th>Date</th><th>Status</th><th>AI</th></tr></thead><tbody>`;
  transactions.slice().reverse().forEach(tx=>{h+=`<tr><td style="color:var(--text-muted)">${tx.id}</td><td class="mono">${tx.patentId}</td><td>${typeBadge(tx.type)}</td><td style="font-weight:600;color:var(--text-primary)">${tx.buyer}</td><td style="font-weight:700;color:var(--text-primary)">${fUSD(tx.amount)}</td><td>${tx.date}</td><td>${txBadge(tx.status)}</td><td>${tx.isAI?'ü§ñ':''}</td></tr>`;});
  h+=`</tbody></table>`;}
  h+=`</div>`;document.getElementById('tab-transactions').innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETAIL MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let detailTab='overview';
function openDetail(pid){currentPatent=patents.find(p=>p.id===pid);if(!currentPatent)return;detailTab='overview';renderDetail();openModal('detailModal');}
function setDetailTab(t){detailTab=t;renderDetail();}
function renderDetail(){
  const p=currentPatent;const avg=Math.round((p.techScore+p.marketScore+p.legalScore)/3);
  const agentScores=aiAgents.filter(a=>a.active).map(a=>({a,s:AIEngine.scoreForAgent(p,a)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s);
  const claimData=patentClaims[p.id];const infrData=infringementData[p.id]||[];const licRef=licenseRefData[p.id];
  const infrHigh=infrData.filter(x=>x.risk==='high').length;const ptTx=transactions.filter(t=>t.patentId===p.id);

  let h=`<div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:14px;margin-bottom:14px">
    <div><div class="patent-meta" style="margin-bottom:4px"><span class="mono" style="font-size:12px">${p.id}</span>${statusBadge(p.status)}${sepBadge(p)}</div>
    <div style="font-size:16px;font-weight:800">${p.title}</div><div style="font-size:11px;color:var(--text-muted)">${p.titleKr}</div></div>
    <div style="text-align:right"><div style="font-size:22px;font-weight:800;color:var(--accent-light)">${fUSD(p.value)}</div><div style="font-size:10px;color:var(--text-muted)">${fKRW(p.value)}</div></div>
  </div>
  ${p.isSEP?`<div style="margin-bottom:10px">${sepInd(p)}</div>`:''}`;

  h+=`<div class="vtool-tabs">
    <button class="vtool-tab${detailTab==='overview'?' active':''}" onclick="setDetailTab('overview')">üìã ${T('overview')}</button>
    <button class="vtool-tab${detailTab==='claims'?' active':''}" onclick="setDetailTab('claims')">üìù ${T('claims')}</button>
    <button class="vtool-tab${detailTab==='infringement'?' active':''}" onclick="setDetailTab('infringement')">‚ö†Ô∏è ${T('infringement')}${infrHigh?' <span style="background:var(--red);color:#fff;padding:1px 5px;border-radius:10px;font-size:9px;margin-left:3px">'+infrHigh+'</span>':''}</button>
    <button class="vtool-tab${detailTab==='valuation'?' active':''}" onclick="setDetailTab('valuation')">üí∞ ${T('valuationTool')}</button>
    <button class="vtool-tab${detailTab==='license'?' active':''}" onclick="setDetailTab('license')">üìú ${T('licenseRef')}</button>
  </div>`;

  // OVERVIEW
  h+=`<div class="vtool-panel${detailTab==='overview'?' active':''}">
    <div class="detail-grid">
      <div class="detail-item"><div class="d-label">${T('owner')}</div><div class="d-value">${p.owner}<br><span style="font-size:10px;color:var(--text-muted)">${p.ownerKr}</span></div></div>
      <div class="detail-item"><div class="d-label">${T('field')}</div><div class="d-value">${p.field}</div></div>
      <div class="detail-item"><div class="d-label">${T('filed')}</div><div class="d-value">${p.filingDate}</div></div>
      <div class="detail-item"><div class="d-label">${T('claims')}</div><div class="d-value">${p.claims}</div></div>
      <div class="detail-item"><div class="d-label">Cited By</div><div class="d-value">${p.citedBy}</div></div>
      <div class="detail-item"><div class="d-label">Remaining</div><div class="d-value">${p.remainingYears}yr</div></div>
    </div>
    <div style="background:var(--bg-surface);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px">
      <div style="font-size:11px;font-weight:700;color:var(--text-secondary);margin-bottom:4px">${T('description')}</div>
      <div style="font-size:12px;color:var(--text-secondary);line-height:1.6">${p.description}</div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px;text-align:center">
      <div><div style="font-size:9px;color:var(--text-muted)">TECH</div><div style="font-size:22px;font-weight:800;color:#3b82f6">${p.techScore}</div><div class="val-meter"><div class="val-meter-fill" style="width:${p.techScore}%;background:#3b82f6"></div></div></div>
      <div><div style="font-size:9px;color:var(--text-muted)">MARKET</div><div style="font-size:22px;font-weight:800;color:var(--emerald)">${p.marketScore}</div><div class="val-meter"><div class="val-meter-fill" style="width:${p.marketScore}%;background:var(--emerald)"></div></div></div>
      <div><div style="font-size:9px;color:var(--text-muted)">LEGAL</div><div style="font-size:22px;font-weight:800;color:var(--amber)">${p.legalScore}</div><div class="val-meter"><div class="val-meter-fill" style="width:${p.legalScore}%;background:var(--amber)"></div></div></div>
    </div>
    ${agentScores.length?`<div style="font-weight:700;font-size:11px;margin-bottom:6px">ü§ñ AI Agent Interest</div><div style="display:flex;gap:5px;flex-wrap:wrap;margin-bottom:12px">${agentScores.map(x=>`<div style="background:${x.a.bg};padding:5px 8px;border-radius:8px;font-size:10px;border:1px solid var(--border)"><span style="font-size:13px">${x.a.avatar}</span> ${x.a.name} <span class="rec-score">${x.s}</span></div>`).join('')}</div>`:''}
  </div>`;

  // CLAIMS
  h+=`<div class="vtool-panel${detailTab==='claims'?' active':''}">`;
  if(claimData){
    h+=`<div style="background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.15);border-radius:12px;padding:14px;margin-bottom:14px">
      <div style="font-size:11px;font-weight:700;color:var(--accent-light);margin-bottom:4px">üìã ${T('claimSummary')}</div>
      <div style="font-size:12px;color:var(--text-secondary);line-height:1.6">${claimData.summary}</div>
      <div style="margin-top:6px;font-size:10px;color:var(--text-muted)">${T('claims')}: ${p.claims} ¬∑ ${T('independent')}: ${claimData.claims.filter(c=>c.type==='ind').length} ¬∑ ${T('dependent')}: ${claimData.claims.filter(c=>c.type==='dep').length}</div>
    </div>`;
    claimData.claims.forEach(c=>{h+=`<div class="claim-card"><div class="claim-num">Claim ${c.num} <span class="claim-type ${c.type==='ind'?'claim-ind':'claim-dep'}">${c.type==='ind'?T('independent'):T('dependent')}</span></div><div class="claim-text">${c.text}</div><div class="claim-keywords">${c.keywords.map(k=>`<span class="claim-kw">${k}</span>`).join('')}</div></div>`;});
  }else h+=`<p style="text-align:center;color:var(--text-muted);padding:30px;font-size:12px">Claim data not available.</p>`;
  h+=`</div>`;

  // INFRINGEMENT
  h+=`<div class="vtool-panel${detailTab==='infringement'?' active':''}">`;
  h+=`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px">
    <div class="detail-item" style="background:rgba(239,68,68,.06)"><div class="d-label" style="color:var(--red)">${T('highRisk')}</div><div class="d-value" style="color:var(--red)">${infrData.filter(x=>x.risk==='high').length} ${T('products')}</div></div>
    <div class="detail-item" style="background:rgba(245,158,11,.06)"><div class="d-label" style="color:var(--amber)">${T('medRisk')}</div><div class="d-value" style="color:var(--amber)">${infrData.filter(x=>x.risk==='medium').length} ${T('products')}</div></div>
    <div class="detail-item" style="background:rgba(16,185,129,.06)"><div class="d-label" style="color:var(--emerald)">${T('lowRisk')}</div><div class="d-value" style="color:var(--emerald)">${infrData.filter(x=>x.risk==='low').length} ${T('products')}</div></div>
  </div>`;
  if(p.isSEP)h+=`<div style="background:var(--sep-bg);border:1px solid var(--sep-border);border-radius:10px;padding:10px 14px;margin-bottom:12px;font-size:11px;color:var(--sep-color)"><strong>‚òÖ SEP (${p.sepStandard})</strong> ‚Äî All standard-compliant implementations practice this patent. FRAND licensing applies.</div>`;
  if(infrData.length){infrData.forEach(inf=>{h+=`<div class="infr-card infr-${inf.risk}"><div class="infr-icon" style="background:${inf.risk==='high'?'rgba(239,68,68,.1)':inf.risk==='medium'?'rgba(245,158,11,.1)':'rgba(16,185,129,.1)'}">${inf.risk==='high'?'üî¥':inf.risk==='medium'?'üü°':'üü¢'}</div><div class="infr-info"><div class="infr-name">${inf.product}</div><div class="infr-company">${inf.company} ¬∑ Risk: <strong>${inf.risk.toUpperCase()}</strong> ¬∑ Claims: ${inf.matchClaims.join(', ')}</div><div class="infr-detail">${inf.detail}</div><div style="font-size:10px;color:var(--text-muted);margin-top:4px">üìé ${inf.evidence}</div></div></div>`;});}
  else h+=`<p style="text-align:center;color:var(--text-muted);padding:20px;font-size:12px">No infringement data available.</p>`;
  h+=`</div>`;

  // VALUATION
  h+=`<div class="vtool-panel${detailTab==='valuation'?' active':''}">`;
  const valFactors=[{label:T('techStrength'),score:p.techScore,color:'#3b82f6',weight:30},{label:T('marketPotential'),score:p.marketScore,color:'var(--emerald)',weight:25},{label:T('legalStability'),score:p.legalScore,color:'var(--amber)',weight:20},{label:T('infrEvidence'),score:infrHigh>0?Math.min(100,60+infrHigh*15):infrData.length>0?50:20,color:'var(--red)',weight:15},{label:T('sepPremium'),score:p.isSEP?95:30,color:'var(--purple)',weight:10}];
  const compositeScore=Math.round(valFactors.reduce((s,f)=>s+f.score*f.weight/100,0));
  const fairValue=Math.round(p.value*(compositeScore/80));
  h+=`<div style="display:flex;gap:16px;margin-bottom:14px;flex-wrap:wrap">
    <div style="flex:1;min-width:180px;background:linear-gradient(135deg,var(--accent),#2563eb);border-radius:14px;padding:18px;color:#fff;text-align:center">
      <div style="font-size:10px;opacity:.8">${T('aiCompositeScore')}</div><div style="font-size:36px;font-weight:900;margin:4px 0">${compositeScore}</div><div style="font-size:10px;opacity:.7">/ 100</div></div>
    <div style="flex:1;min-width:180px;background:linear-gradient(135deg,var(--emerald),var(--emerald-d));border-radius:14px;padding:18px;color:#fff;text-align:center">
      <div style="font-size:10px;opacity:.8">${T('aiFairValue')}</div><div style="font-size:22px;font-weight:900;margin:4px 0">${fUSD(fairValue)}</div><div style="font-size:10px;opacity:.7">${fKRW(fairValue)}</div></div>
    <div style="flex:1;min-width:180px;background:${fairValue>p.value?'linear-gradient(135deg,#22c55e,#16a34a)':'linear-gradient(135deg,#f87171,#dc2626)'};border-radius:14px;padding:18px;color:#fff;text-align:center">
      <div style="font-size:10px;opacity:.8">${fairValue>p.value?T('undervalued'):T('overvalued')}</div><div style="font-size:22px;font-weight:900;margin:4px 0">${fairValue>p.value?'+':''}${((fairValue-p.value)/p.value*100).toFixed(1)}%</div><div style="font-size:10px;opacity:.7">vs Current</div></div>
  </div>`;
  valFactors.forEach(f=>{h+=`<div style="margin-bottom:10px"><div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:3px"><span style="font-weight:700;color:var(--text-primary)">${f.label}</span><span style="font-weight:700;color:var(--text-primary)">${f.score}/100 <span style="color:var(--text-muted);font-weight:400">(${f.weight}%)</span></span></div><div class="val-meter" style="height:8px"><div class="val-meter-fill" style="width:${f.score}%;background:${f.color}"></div></div></div>`;});
  h+=`<div style="background:var(--bg-surface);border:1px solid var(--border);border-radius:10px;padding:12px;margin-top:14px;font-size:11px;color:var(--text-secondary)">
    <strong>AI Analysis:</strong> ${compositeScore>=80?'Excellent patent with strong fundamentals.':compositeScore>=60?'Good patent with solid potential.':'Moderate patent. Consider risk factors.'}
    ${infrHigh>0?` ${infrHigh} high-risk target(s) ‚Äî strong enforcement potential.`:''}
    ${p.isSEP?' SEP status provides guaranteed licensing revenue under FRAND.':''}
  </div></div>`;

  // LICENSE REF
  h+=`<div class="vtool-panel${detailTab==='license'?' active':''}">`;
  if(licRef){
    h+=`<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-bottom:14px">
      <div class="detail-item"><div class="d-label">${T('avgRoyaltyRate')}</div><div class="d-value" style="color:var(--accent-light)">${licRef.avgRate}%</div></div>
      <div class="detail-item"><div class="d-label">${T('typicalLumpSum')}</div><div class="d-value">${fUSD(licRef.typicalLump)}</div></div>
      ${licRef.frandRate?`<div class="detail-item" style="background:var(--sep-bg);border-color:var(--sep-border)"><div class="d-label" style="color:var(--sep-color)">${T('frandRange')}</div><div class="d-value" style="color:var(--sep-color)">${licRef.frandRate}</div></div>`:''}
    </div>`;
    h+=`<div style="background:var(--bg-surface);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:14px;font-size:11px;color:var(--text-secondary)"><strong>üìä Comparable:</strong> ${licRef.comparable}</div>`;
    if(licRef.recentDeals.length){h+=`<div style="font-weight:700;font-size:12px;margin-bottom:8px;color:var(--text-primary)">${T('recentLicenseDeals')}</div>`;licRef.recentDeals.forEach(d=>{h+=`<div class="lic-ref-row"><div><strong style="color:var(--text-primary)">${d.licensee}</strong><div style="font-size:10px;color:var(--text-muted)">${d.type} ¬∑ ${d.date}</div></div><div style="text-align:right;font-weight:700;color:var(--text-primary)">${d.amount?fUSD(d.amount):''}${d.rate?' Rate: '+d.rate:''}</div></div>`;});}
    if(ptTx.length){h+=`<div style="font-weight:700;font-size:12px;margin:14px 0 8px;color:var(--text-primary)">${T('platformTxHistory')}</div>`;ptTx.forEach(t=>{h+=`<div class="lic-ref-row"><div><strong style="color:var(--text-primary)">${t.buyer}</strong>${t.isAI?' ü§ñ':''}<div style="font-size:10px;color:var(--text-muted)">${t.type} ¬∑ ${t.date}</div></div><div style="text-align:right">${typeBadge(t.type)} <strong style="color:var(--text-primary)">${fUSD(t.amount)}</strong></div></div>`;});}
  }else h+=`<p style="text-align:center;color:var(--text-muted);padding:20px;font-size:12px">License reference data not available.</p>`;
  h+=`</div>`;

  // Action buttons
  h+=`<div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:14px;padding-top:14px;border-top:1px solid var(--border)">
    <button class="btn btn-outline btn-lg" onclick="closeModal('detailModal');openCandleModal('${p.id}')">üìà Chart</button>`;
  if(!isGuest()){
    if(p.forSale)h+=`<button class="btn btn-primary btn-lg" onclick="closeModal('detailModal');openTrade('${p.id}')">Trade</button>`;
    if(p.forLicense)h+=`<button class="btn btn-emerald btn-lg" onclick="closeModal('detailModal');openLicense('${p.id}')">License</button>`;
    h+=`<button class="btn btn-purple btn-lg" onclick="closeModal('detailModal');autoAgentDeal('${p.id}')">ü§ñ AI Deal</button>`;
  }
  h+=`</div>`;
  document.getElementById('detailBody').innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRADE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openTrade(pid){if(isGuest()){notify('Login required.','error');return;}currentPatent=patents.find(p=>p.id===pid);if(!currentPatent)return;const p=currentPatent;
  document.getElementById('tradeBody').innerHTML=`
  <div class="info-box info-box-blue"><div class="info-label" style="color:var(--accent-light)">Target Patent</div>
  <div class="info-title">${p.title}${p.isSEP?' <span class="badge-sep">SEP</span>':''}</div><div class="info-sub">Valuation: <strong style="color:var(--accent-light)">${fUSD(p.value)}</strong> (${fKRW(p.value)})</div></div>
  <div class="form-group"><label class="form-label">${currentRole==='buyer'?T('buyer'):T('seller')} Name *</label><input class="form-input" id="tradeBuyer" placeholder="Name"></div>
  <div class="form-group"><label class="form-label">Organization</label><input class="form-input" id="tradeOrg" placeholder="Company"></div>
  <div class="form-group"><label class="form-label">Offer Price (KRW) *</label><input class="form-input" type="number" id="tradePrice" placeholder="Amount" oninput="document.getElementById('tradeH').textContent=this.value?fUSD(parseInt(this.value)):''"><div class="form-hint" id="tradeH"></div></div>
  <div class="form-group"><label class="form-label">Message</label><textarea class="form-textarea" id="tradeMsg" rows="2" placeholder="Note"></textarea></div>
  <div style="display:flex;gap:10px;margin-top:16px"><button class="btn btn-gray btn-lg" onclick="closeModal('tradeModal')">${T('cancel')}</button><button class="btn btn-primary btn-lg" onclick="submitTrade()">${T('submit')}</button></div>`;
  openModal('tradeModal');
}
function submitTrade(){const b=document.getElementById('tradeBuyer').value,pr=document.getElementById('tradePrice').value;if(!b||!pr){notify('Name and price required.','error');return;}transactions.push({id:transactions.length+1,patentId:currentPatent.id,type:'Trade',buyer:document.getElementById('tradeOrg').value||b,amount:parseInt(pr),date:new Date().toISOString().slice(0,10),status:'Negotiating',isAI:false});closeModal('tradeModal');notify('Trade request submitted!');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LICENSE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let licType='lumpsum';
function openLicense(pid){if(isGuest()){notify('Login required.','error');return;}currentPatent=patents.find(p=>p.id===pid);if(!currentPatent)return;licType='lumpsum';renderLM();openModal('licenseModal');}
function setLT(t){licType=t;renderLM();}
function renderLM(){const p=currentPatent;const durs=[1,2,3,5,7,10,15,20];const terr=['Korea','Asia-Pacific','Worldwide (Non-exclusive)','Worldwide (Exclusive)'];
  let cond='';
  if(licType==='lumpsum'){cond=`<div class="condition-box"><h4>${T('lumpSum')}</h4>
    <div class="form-group"><label class="form-label">Amount (KRW)</label><input class="form-input" type="number" id="lumpAmt" placeholder="Amount" oninput="document.getElementById('lumpH').textContent=this.value?fUSD(parseInt(this.value)):''"><div class="form-hint" id="lumpH"></div></div>
    <div class="form-row"><div class="form-group"><label class="form-label">Duration</label><select class="form-select" id="licDur">${durs.map(y=>`<option value="${y}"${y===5?' selected':''}>${y}yr</option>`).join('')}</select></div>
    <div class="form-group"><label class="form-label">Territory</label><select class="form-select" id="licTerr">${terr.map(t=>`<option>${t}</option>`).join('')}</select></div></div></div>`;}
  else{cond=`<div class="condition-box"><h4>${T('runningRoyalty')}</h4>
    <div class="form-row"><div class="form-group"><label class="form-label">Rate (%)</label><input class="form-input" type="number" step="0.1" id="royRate" placeholder="e.g. 3.5" oninput="updateRS()"></div>
    <div class="form-group"><label class="form-label">Base</label><select class="form-select" id="royBase"><option>Revenue</option><option>Net Revenue</option><option>Per Unit</option></select></div></div>
    <div class="form-group"><label class="form-label">Min Annual (KRW)</label><input class="form-input" type="number" id="minRoy" placeholder="Minimum"></div>
    <div class="form-row"><div class="form-group"><label class="form-label">Duration</label><select class="form-select" id="licDur">${durs.map(y=>`<option value="${y}"${y===5?' selected':''}>${y}yr</option>`).join('')}</select></div>
    <div class="form-group"><label class="form-label">Territory</label><select class="form-select" id="licTerr">${terr.map(t=>`<option>${t}</option>`).join('')}</select></div></div>
    <div class="sim-box" id="roySim" style="display:none"><div class="sim-label">Sim ($100M revenue)</div><div class="sim-value" id="simV"></div><div class="sim-sub" id="simT"></div></div></div>`;}
  document.getElementById('licenseBody').innerHTML=`
  <div class="info-box info-box-emerald"><div class="info-label" style="color:var(--emerald)">Target Patent</div>
  <div class="info-title">${p.title}${p.isSEP?' <span class="badge-sep">SEP</span>':''}</div><div class="info-sub">${T('owner')}: ${p.owner} ¬∑ ${fUSD(p.value)}</div></div>
  <div style="margin-bottom:14px"><label class="form-label">Payment Type</label>
  <div class="type-grid"><div class="type-card${licType==='lumpsum'?' selected':''}" onclick="setLT('lumpsum')"><h4>${T('lumpSum')}</h4><p>One-time payment</p></div>
  <div class="type-card${licType==='running'?' selected':''}" onclick="setLT('running')"><h4>${T('runningRoyalty')}</h4><p>Ongoing royalty</p></div></div></div>
  <div class="form-row"><div class="form-group"><label class="form-label">${currentRole==='licensor'?T('licensee'):T('licensor')} *</label><input class="form-input" id="licensee" placeholder="Name"></div>
  <div class="form-group"><label class="form-label">Organization</label><input class="form-input" id="licOrg" placeholder="Company"></div></div>
  ${cond}
  <div style="display:flex;gap:10px;margin-top:16px"><button class="btn btn-gray btn-lg" onclick="closeModal('licenseModal')">${T('cancel')}</button>
  <button class="btn btn-emerald btn-lg" onclick="submitLicense()">${T('submit')}</button></div>`;
}
function updateRS(){const r=parseFloat(document.getElementById('royRate')?.value||0);const s=document.getElementById('roySim');if(r>0){s.style.display='block';const a=1e10*r/100;const d=parseInt(document.getElementById('licDur')?.value||5);document.getElementById('simV').textContent=fUSD(a)+'/yr';document.getElementById('simT').textContent=d+'yr total: '+fUSD(a*d);}else s.style.display='none';}
function submitLicense(){const l=document.getElementById('licensee')?.value;if(!l){notify('Name required.','error');return;}let amt=0;if(licType==='lumpsum')amt=parseInt(document.getElementById('lumpAmt')?.value||0);else amt=parseInt(document.getElementById('minRoy')?.value||0);transactions.push({id:transactions.length+1,patentId:currentPatent.id,type:'License',buyer:document.getElementById('licOrg')?.value||l,amount:amt,date:new Date().toISOString().slice(0,10),status:'Negotiating',isAI:false});closeModal('licenseModal');notify('License request submitted!');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPLOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let upMode='form';let csvData=[];
function openUploadModal(){if(isGuest()){notify('Login required.','error');return;}upMode='form';csvData=[];renderUM();openModal('uploadModal');}
function setUM(m){upMode=m;renderUM();}
function renderUM(){
  const fields=['AI','Security','Energy','Software','Bio','Manufacturing','Telecom','Environment','Other'];
  let h=`<div class="type-grid" style="margin-bottom:14px">
    <div class="type-card${upMode==='form'?' selected':''}" onclick="setUM('form')"><h4>${T('manualEntry')}</h4><p>Single patent</p></div>
    <div class="type-card${upMode==='csv'?' selected':''}" onclick="setUM('csv')"><h4>${T('csvUpload')}</h4><p>Bulk upload</p></div></div>`;
  if(upMode==='form'){
    h+=`<div class="form-row"><div class="form-group"><label class="form-label">Title *</label><input class="form-input" id="upTitle"></div>
    <div class="form-group"><label class="form-label">ID</label><input class="form-input" id="upId" placeholder="Auto"></div></div>
    <div class="form-row"><div class="form-group"><label class="form-label">Korean Title</label><input class="form-input" id="upTitleKr"></div>
    <div class="form-group"><label class="form-label">${T('owner')} *</label><input class="form-input" id="upOwner"></div></div>
    <div class="form-row-3"><div class="form-group"><label class="form-label">${T('field')} *</label><select class="form-select" id="upField">${fields.map(f=>`<option>${f}</option>`).join('')}</select></div>
    <div class="form-group"><label class="form-label">Status</label><select class="form-select" id="upStatus"><option>Granted</option><option>Published</option><option>Under Review</option></select></div>
    <div class="form-group"><label class="form-label">${T('filed')}</label><input class="form-input" type="date" id="upDate"></div></div>
    <div class="form-row-3"><div class="form-group"><label class="form-label">Value (KRW) *</label><input class="form-input" type="number" id="upValue"></div>
    <div class="form-group"><label class="form-label">${T('claims')}</label><input class="form-input" type="number" id="upClaims" value="10"></div>
    <div class="form-group" style="display:flex;align-items:center;padding-top:20px"><label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:12px;font-weight:600;color:var(--text-primary)"><input type="checkbox" id="upSEP" style="width:16px;height:16px;accent-color:#f59e0b" onchange="document.getElementById('sepF').style.display=this.checked?'block':'none'">‚òÖ SEP</label></div></div>
    <div id="sepF" style="display:none"><div class="form-group"><label class="form-label">SEP Standard</label><input class="form-input" id="upSepStd" placeholder="e.g. 3GPP TS 38.214"></div></div>
    <div class="form-row"><div class="form-group"><label style="display:flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--text-primary)"><input type="checkbox" id="upForSale" checked style="width:14px;height:14px">For Sale</label></div>
    <div class="form-group"><label style="display:flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--text-primary)"><input type="checkbox" id="upForLic" checked style="width:14px;height:14px">Licensable</label></div></div>
    <div class="form-group"><label class="form-label">${T('description')}</label><textarea class="form-textarea" id="upDesc" rows="2"></textarea></div>
    <div style="display:flex;gap:10px;margin-top:14px"><button class="btn btn-gray btn-lg" onclick="closeModal('uploadModal')">${T('cancel')}</button><button class="btn btn-orange btn-lg" onclick="submitUp()">${T('register')}</button></div>`;
  }else{
    h+=`<div class="upload-zone" id="uploadZone" onclick="document.getElementById('csvFile').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="event.preventDefault();this.classList.remove('dragover');handleCSVDrop(event)">
    <p>Drag & drop CSV or click to upload</p></div><input type="file" id="csvFile" accept=".csv" style="display:none" onchange="handleCSVSel(event)"><div id="csvPrev"></div>
    <div style="display:flex;gap:10px;margin-top:14px"><button class="btn btn-gray btn-lg" onclick="closeModal('uploadModal')">${T('cancel')}</button><button class="btn btn-orange btn-lg" id="csvBtn" onclick="submitCSV()" style="display:none">${T('register')} (<span id="csvCnt">0</span>)</button></div>`;
  }
  document.getElementById('uploadBody').innerHTML=h;
}
function submitUp(){const t=document.getElementById('upTitle')?.value?.trim(),o=document.getElementById('upOwner')?.value?.trim(),v=parseInt(document.getElementById('upValue')?.value||0);if(!t||!o||!v){notify('Title, Owner, Value required.','error');return;}const isSEP=document.getElementById('upSEP')?.checked||false;const id=document.getElementById('upId')?.value?.trim()||('KR-'+new Date().getFullYear()+'-'+String(Math.floor(Math.random()*900000)+100000));patents.push({id,title:t,titleKr:document.getElementById('upTitleKr')?.value||t,owner:o,ownerKr:o,field:document.getElementById('upField')?.value||'Other',fieldKr:'Í∏∞ÌÉÄ',filingDate:document.getElementById('upDate')?.value||new Date().toISOString().slice(0,10),status:document.getElementById('upStatus')?.value||'Granted',value:v,description:document.getElementById('upDesc')?.value||'',descKr:'',claims:parseInt(document.getElementById('upClaims')?.value||10),citedBy:0,remainingYears:18,techScore:85,marketScore:80,legalScore:85,isSEP,sepStandard:isSEP?document.getElementById('upSepStd')?.value||'':'',forSale:document.getElementById('upForSale')?.checked??true,forLicense:document.getElementById('upForLic')?.checked??true});closeModal('uploadModal');updateTV();notify(`"${t}" registered!${isSEP?' (SEP)':''}`);}
function parseCSV(text){const lines=text.split('\n').map(l=>l.trim()).filter(l=>l);if(lines.length<2)return[];const hd=lines[0].split(',').map(h=>h.trim().replace(/"/g,''));return lines.slice(1).map(line=>{const vals=[];let cur='',inQ=false;for(const ch of line){if(ch==='"')inQ=!inQ;else if(ch===','&&!inQ){vals.push(cur.trim());cur='';}else cur+=ch;}vals.push(cur.trim());const obj={};hd.forEach((h,i)=>obj[h]=vals[i]||'');return obj;});}
function handleCSVSel(e){const f=e.target.files[0];if(f)readCSV(f);}
function handleCSVDrop(e){const f=e.dataTransfer.files[0];if(f)readCSV(f);}
function readCSV(file){const r=new FileReader();r.onload=function(e){csvData=parseCSV(e.target.result);if(!csvData.length){notify('Parse failed.','error');return;}document.getElementById('csvBtn').style.display='';document.getElementById('csvCnt').textContent=csvData.length;document.getElementById('csvPrev').innerHTML=`<div style="background:var(--bg-surface);border:1px solid var(--border);border-radius:10px;padding:10px;font-size:11px;max-height:180px;overflow:auto"><table><thead><tr>${Object.keys(csvData[0]).map(k=>`<th>${k}</th>`).join('')}</tr></thead><tbody>${csvData.slice(0,5).map(r=>`<tr>${Object.values(r).map(v=>`<td>${v}</td>`).join('')}</tr>`).join('')}</tbody></table></div>`;};r.readAsText(file);}
function submitCSV(){let n=0;csvData.forEach(r=>{const t=r.title||r.Title,o=r.owner||r.Owner,v=parseInt(r.value||r.Value||0);if(!t||!o||!v)return;patents.push({id:r.id||('KR-'+new Date().getFullYear()+'-'+String(Math.floor(Math.random()*900000)+100000)),title:t,titleKr:r.titleKr||t,owner:o,ownerKr:r.ownerKr||o,field:r.field||'Other',fieldKr:'Í∏∞ÌÉÄ',filingDate:r.filingDate||new Date().toISOString().slice(0,10),status:r.status||'Granted',value:v,description:r.description||'',descKr:'',claims:parseInt(r.claims||10),citedBy:0,remainingYears:18,techScore:parseInt(r.techScore||85),marketScore:parseInt(r.marketScore||80),legalScore:parseInt(r.legalScore||85),isSEP:r.isSEP==='true',sepStandard:r.sepStandard||'',forSale:true,forLicense:true});n++;});closeModal('uploadModal');updateTV();notify(`${n} patents registered.`);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded',()=>{
  createParticles();
  updateTV();
  addFeed('üìä','rgba(100,116,139,.1)','System','Horizon Patent Platform initialized. '+patents.length+' patents loaded. '+aiAgents.length+' AI agents ready.','system');
  addFeed('ü§ñ','rgba(59,130,246,.1)','AlphaPatent AI','Scanning market for Telecom & AI patent opportunities...','agent-alpha');
  addFeed('üß†','rgba(16,185,129,.1)','BetaLicense AI','Analyzing Energy & Bio licensing targets...','agent-beta');
  addFeed('‚ö°','rgba(245,158,11,.1)','GammaSeller AI','Monitoring patent valuations for optimal sale timing...','agent-gamma');
});
</script>
</body>
</html>
